// Push notification service using Firebase Cloud Messaging\nimport * as Notifications from 'expo-notifications';\nimport * as Device from 'expo-device';\nimport Constants from 'expo-constants';\n\ninterface NotificationData {\n  type: 'order' | 'job' | 'message' | 'payment' | 'alert' | 'promotion';\n  title: string;\n  message: string;\n  data?: Record<string, any>;\n  deepLink?: string;\n}\n\nclass NotificationService {\n  private expoPushToken: string | null = null;\n  private notificationListener: any = null;\n  private responseListener: any = null;\n\n  /**\n   * Initialize notification service\n   */\n  async initialize(): Promise<void> {\n    try {\n      // Set notification handler\n      Notifications.setNotificationHandler({\n        handleNotification: async () => ({\n          shouldShowAlert: true,\n          shouldPlaySound: true,\n          shouldSetBadge: true,\n        }),\n      });\n\n      // Request permissions\n      await this.requestPermissions();\n\n      // Get Expo push token\n      this.expoPushToken = await this.getExpoPushToken();\n      console.log('Expo Push Token:', this.expoPushToken);\n    } catch (error) {\n      console.error('Failed to initialize notifications:', error);\n    }\n  }\n\n  /**\n   * Request notification permissions\n   */\n  private async requestPermissions(): Promise<void> {\n    if (Device.isDevice) {\n      const { status: existingStatus } = await Notifications.getPermissionsAsync();\n      let finalStatus = existingStatus;\n\n      if (existingStatus !== 'granted') {\n        const { status } = await Notifications.requestPermissionsAsync();\n        finalStatus = status;\n      }\n\n      if (finalStatus !== 'granted') {\n        console.warn('Failed to get push token for push notification!');\n      }\n    }\n  }\n\n  /**\n   * Get Expo push token\n   */\n  private async getExpoPushToken(): Promise<string> {\n    try {\n      const projectId = Constants.expoConfig?.extra?.eas?.projectId;\n      if (!projectId) {\n        throw new Error('Project ID not found');\n      }\n\n      const token = await Notifications.getExpoPushTokenAsync({\n        projectId,\n      });\n\n      return token.data;\n    } catch (error) {\n      console.error('Failed to get Expo push token:', error);\n      return '';\n    }\n  }\n\n  /**\n   * Get push token\n   */\n  getPushToken(): string | null {\n    return this.expoPushToken;\n  }\n\n  /**\n   * Subscribe to notifications\n   */\n  subscribeToNotifications(callback: (notification: Notifications.Notification) => void): void {\n    this.notificationListener = Notifications.addNotificationReceivedListener(callback);\n  }\n\n  /**\n   * Subscribe to notification responses (when user taps notification)\n   */\n  subscribeToNotificationResponses(\n    callback: (response: Notifications.NotificationResponse) => void\n  ): void {\n    this.responseListener = Notifications.addNotificationResponseReceivedListener(callback);\n  }\n\n  /**\n   * Unsubscribe from notifications\n   */\n  unsubscribeFromNotifications(): void {\n    if (this.notificationListener) {\n      Notifications.removeNotificationSubscription(this.notificationListener);\n    }\n    if (this.responseListener) {\n      Notifications.removeNotificationSubscription(this.responseListener);\n    }\n  }\n\n  /**\n   * Send local notification\n   */\n  async sendLocalNotification(data: NotificationData): Promise<void> {\n    try {\n      await Notifications.scheduleNotificationAsync({\n        content: {\n          title: data.title,\n          body: data.message,\n          data: {\n            type: data.type,\n            ...data.data,\n            deepLink: data.deepLink,\n          },\n          sound: 'default',\n          badge: 1,\n        },\n        trigger: null, // Send immediately\n      });\n    } catch (error) {\n      console.error('Failed to send local notification:', error);\n    }\n  }\n\n  /**\n   * Schedule notification\n   */\n  async scheduleNotification(\n    data: NotificationData,\n    delayInSeconds: number\n  ): Promise<void> {\n    try {\n      await Notifications.scheduleNotificationAsync({\n        content: {\n          title: data.title,\n          body: data.message,\n          data: {\n            type: data.type,\n            ...data.data,\n            deepLink: data.deepLink,\n          },\n          sound: 'default',\n          badge: 1,\n        },\n        trigger: {\n          seconds: delayInSeconds,\n        },\n      });\n    } catch (error) {\n      console.error('Failed to schedule notification:', error);\n    }\n  }\n\n  /**\n   * Cancel all notifications\n   */\n  async cancelAllNotifications(): Promise<void> {\n    try {\n      await Notifications.cancelAllScheduledNotificationsAsync();\n    } catch (error) {\n      console.error('Failed to cancel notifications:', error);\n    }\n  }\n\n  /**\n   * Send job offer notification\n   */\n  async sendJobOfferNotification(\n    jobId: string,\n    pickupLocation: string,\n    dropoffLocation: string,\n    estimatedEarnings: number\n  ): Promise<void> {\n    await this.sendLocalNotification({\n      type: 'job',\n      title: 'üöó New Job Offer!',\n      message: `${pickupLocation} ‚Üí ${dropoffLocation} ‚Ä¢ ‚Ç≠${estimatedEarnings}`,\n      data: {\n        jobId,\n        pickupLocation,\n        dropoffLocation,\n        estimatedEarnings,\n      },\n      deepLink: `ntumai://job/${jobId}`,\n    });\n  }\n\n  /**\n   * Send order status notification\n   */\n  async sendOrderStatusNotification(\n    orderId: string,\n    status: string,\n    message: string\n  ): Promise<void> {\n    await this.sendLocalNotification({\n      type: 'order',\n      title: `Order ${status}`,\n      message,\n      data: {\n        orderId,\n        status,\n      },\n      deepLink: `ntumai://order/${orderId}`,\n    });\n  }\n\n  /**\n   * Send message notification\n   */\n  async sendMessageNotification(\n    chatId: string,\n    senderName: string,\n    message: string\n  ): Promise<void> {\n    await this.sendLocalNotification({\n      type: 'message',\n      title: senderName,\n      message,\n      data: {\n        chatId,\n        senderName,\n      },\n      deepLink: `ntumai://chat/${chatId}`,\n    });\n  }\n\n  /**\n   * Send payment notification\n   */\n  async sendPaymentNotification(\n    amount: number,\n    status: 'success' | 'failed',\n    message: string\n  ): Promise<void> {\n    await this.sendLocalNotification({\n      type: 'payment',\n      title: `Payment ${status === 'success' ? '‚úÖ' : '‚ùå'}`,\n      message,\n      data: {\n        amount,\n        status,\n      },\n    });\n  }\n\n  /**\n   * Send alert notification\n   */\n  async sendAlertNotification(title: string, message: string): Promise<void> {\n    await this.sendLocalNotification({\n      type: 'alert',\n      title,\n      message,\n    });\n  }\n\n  /**\n   * Send promotion notification\n   */\n  async sendPromotionNotification(\n    title: string,\n    message: string,\n    deepLink?: string\n  ): Promise<void> {\n    await this.sendLocalNotification({\n      type: 'promotion',\n      title,\n      message,\n      deepLink,\n    });\n  }\n}\n\nexport const notificationService = new NotificationService();\n
