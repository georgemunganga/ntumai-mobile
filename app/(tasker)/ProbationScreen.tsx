import React, { useState, useEffect } from 'react';\nimport {\n  View,\n  Text,\n  ScrollView,\n  ActivityIndicator,\n  Alert,\n  Dimensions,\n} from 'react-native';\nimport { kpiMockService } from '../../src/api/mockServices.extended';\nimport { ProgressBar } from '../../src/components';\n\nconst { width } = Dimensions.get('window');\n\ninterface KPI {\n  name: string;\n  current: number;\n  target: number;\n  unit: string;\n  status: 'good' | 'warning' | 'critical';\n}\n\nexport default function ProbationScreen() {\n  const [kpis, setKpis] = useState<any>(null);\n  const [loading, setLoading] = useState(true);\n  const [alerts, setAlerts] = useState<any[]>([]);\n\n  useEffect(() => {\n    loadProbationData();\n  }, []);\n\n  const loadProbationData = async () => {\n    try {\n      const response = await kpiMockService.getProbationKPIs('tasker_1');\n      if (response.success) {\n        setKpis(response.data);\n        setAlerts(response.data.alerts || []);\n      }\n    } catch (error) {\n      Alert.alert('Error', 'Failed to load probation data');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const getKPIStatus = (current: number, target: number): 'good' | 'warning' | 'critical' => {\n    const percentage = (current / target) * 100;\n    if (percentage >= 100) return 'good';\n    if (percentage >= 90) return 'warning';\n    return 'critical';\n  };\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case 'good':\n        return 'bg-green-100 border-green-300';\n      case 'warning':\n        return 'bg-yellow-100 border-yellow-300';\n      case 'critical':\n        return 'bg-red-100 border-red-300';\n      default:\n        return 'bg-gray-100 border-gray-300';\n    }\n  };\n\n  const getStatusTextColor = (status: string) => {\n    switch (status) {\n      case 'good':\n        return 'text-green-700';\n      case 'warning':\n        return 'text-yellow-700';\n      case 'critical':\n        return 'text-red-700';\n      default:\n        return 'text-gray-700';\n    }\n  };\n\n  if (loading) {\n    return (\n      <View className=\"flex-1 justify-center items-center bg-white\">\n        <ActivityIndicator size=\"large\" color=\"#FF6B35\" />\n      </View>\n    );\n  }\n\n  if (!kpis) {\n    return (\n      <View className=\"flex-1 justify-center items-center bg-white\">\n        <Text className=\"text-gray-600\">No probation data available</Text>\n      </View>\n    );\n  }\n\n  return (\n    <ScrollView className=\"flex-1 bg-gray-50\">\n      {/* Header */}\n      <View className=\"bg-white border-b border-gray-200 px-4 py-4\">\n        <Text className=\"text-2xl font-bold text-gray-900\">Probation Period</Text>\n        <Text className=\"text-sm text-gray-600 mt-1\">\n          {kpis.daysRemaining} days remaining\n        </Text>\n      </View>\n\n      <View className=\"px-4 py-4\">\n        {/* Probation Progress */}\n        <View className=\"bg-white rounded-lg p-4 mb-4 border border-gray-200\">\n          <Text className=\"text-lg font-bold text-gray-900 mb-3\">Progress</Text>\n          <View className=\"mb-2\">\n            <View className=\"flex-row justify-between items-center mb-2\">\n              <Text className=\"text-sm text-gray-600\">Days Completed</Text>\n              <Text className=\"text-sm font-semibold text-gray-900\">\n                {14 - kpis.daysRemaining}/14\n              </Text>\n            </View>\n            <View className=\"h-2 bg-gray-200 rounded-full overflow-hidden\">\n              <View\n                className=\"h-full bg-green-500\"\n                style={{\n                  width: `${((14 - kpis.daysRemaining) / 14) * 100}%`,\n                }}\n              />\n            </View>\n          </View>\n        </View>\n\n        {/* Alerts */}\n        {alerts.length > 0 && (\n          <View className=\"bg-red-50 rounded-lg p-4 mb-4 border border-red-200\">\n            <Text className=\"text-lg font-bold text-red-900 mb-2\">⚠️ Alerts</Text>\n            {alerts.map((alert, index) => (\n              <Text key={index} className=\"text-sm text-red-700 mb-1\">\n                • {alert.message}\n              </Text>\n            ))}\n          </View>\n        )}\n\n        {/* KPI Cards */}\n        <Text className=\"text-lg font-bold text-gray-900 mb-3\">Key Performance Indicators</Text>\n\n        {/* Acceptance Rate */}\n        <View className={`rounded-lg p-4 mb-3 border ${getStatusColor(\n          getKPIStatus(kpis.kpis.acceptanceRate, kpis.targets.acceptanceRate)\n        )}`}>\n          <View className=\"flex-row justify-between items-start mb-2\">\n            <View>\n              <Text className=\"text-sm text-gray-600\">Acceptance Rate</Text>\n              <Text className=\"text-2xl font-bold text-gray-900 mt-1\">\n                {kpis.kpis.acceptanceRate}%\n              </Text>\n            </View>\n            <Text className={`text-sm font-semibold ${getStatusTextColor(\n              getKPIStatus(kpis.kpis.acceptanceRate, kpis.targets.acceptanceRate)\n            )}`}>\n              Target: {kpis.targets.acceptanceRate}%\n            </Text>\n          </View>\n          <View className=\"h-2 bg-gray-300 rounded-full overflow-hidden\">\n            <View\n              className=\"h-full bg-blue-500\"\n              style={{\n                width: `${Math.min((kpis.kpis.acceptanceRate / kpis.targets.acceptanceRate) * 100, 100)}%`,\n              }}\n            />\n          </View>\n        </View>\n\n        {/* On-Time Rate */}\n        <View className={`rounded-lg p-4 mb-3 border ${getStatusColor(\n          getKPIStatus(kpis.kpis.onTimeRate, kpis.targets.onTimeRate)\n        )}`}>\n          <View className=\"flex-row justify-between items-start mb-2\">\n            <View>\n              <Text className=\"text-sm text-gray-600\">On-Time Rate</Text>\n              <Text className=\"text-2xl font-bold text-gray-900 mt-1\">\n                {kpis.kpis.onTimeRate}%\n              </Text>\n            </View>\n            <Text className={`text-sm font-semibold ${getStatusTextColor(\n              getKPIStatus(kpis.kpis.onTimeRate, kpis.targets.onTimeRate)\n            )}`}>\n              Target: {kpis.targets.onTimeRate}%\n            </Text>\n          </View>\n          <View className=\"h-2 bg-gray-300 rounded-full overflow-hidden\">\n            <View\n              className=\"h-full bg-orange-500\"\n              style={{\n                width: `${Math.min((kpis.kpis.onTimeRate / kpis.targets.onTimeRate) * 100, 100)}%`,\n              }}\n            />\n          </View>\n        </View>\n\n        {/* Completion Rate */}\n        <View className={`rounded-lg p-4 mb-3 border ${getStatusColor(\n          getKPIStatus(kpis.kpis.completionRate, kpis.targets.completionRate)\n        )}`}>\n          <View className=\"flex-row justify-between items-start mb-2\">\n            <View>\n              <Text className=\"text-sm text-gray-600\">Completion Rate</Text>\n              <Text className=\"text-2xl font-bold text-gray-900 mt-1\">\n                {kpis.kpis.completionRate}%\n              </Text>\n            </View>\n            <Text className={`text-sm font-semibold ${getStatusTextColor(\n              getKPIStatus(kpis.kpis.completionRate, kpis.targets.completionRate)\n            )}`}>\n              Target: {kpis.targets.completionRate}%\n            </Text>\n          </View>\n          <View className=\"h-2 bg-gray-300 rounded-full overflow-hidden\">\n            <View\n              className=\"h-full bg-green-500\"\n              style={{\n                width: `${Math.min((kpis.kpis.completionRate / kpis.targets.completionRate) * 100, 100)}%`,\n              }}\n            />\n          </View>\n        </View>\n\n        {/* Average Rating */}\n        <View className={`rounded-lg p-4 mb-3 border ${getStatusColor(\n          getKPIStatus(kpis.kpis.averageRating * 20, kpis.targets.averageRating * 20)\n        )}`}>\n          <View className=\"flex-row justify-between items-start mb-2\">\n            <View>\n              <Text className=\"text-sm text-gray-600\">Average Rating</Text>\n              <Text className=\"text-2xl font-bold text-gray-900 mt-1\">\n                {kpis.kpis.averageRating} ⭐\n              </Text>\n            </View>\n            <Text className={`text-sm font-semibold ${getStatusTextColor(\n              getKPIStatus(kpis.kpis.averageRating * 20, kpis.targets.averageRating * 20)\n            )}`}>\n              Target: {kpis.targets.averageRating}\n            </Text>\n          </View>\n          <View className=\"h-2 bg-gray-300 rounded-full overflow-hidden\">\n            <View\n              className=\"h-full bg-yellow-500\"\n              style={{\n                width: `${Math.min((kpis.kpis.averageRating / kpis.targets.averageRating) * 100, 100)}%`,\n              }}\n            />\n          </View>\n        </View>\n\n        {/* Incident Rate */}\n        <View className={`rounded-lg p-4 mb-4 border ${getStatusColor(\n          kpis.kpis.incidentRate <= kpis.targets.incidentRate ? 'good' : 'critical'\n        )}`}>\n          <View className=\"flex-row justify-between items-start mb-2\">\n            <View>\n              <Text className=\"text-sm text-gray-600\">Incident Rate</Text>\n              <Text className=\"text-2xl font-bold text-gray-900 mt-1\">\n                {kpis.kpis.incidentRate}%\n              </Text>\n            </View>\n            <Text className={`text-sm font-semibold ${getStatusTextColor(\n              kpis.kpis.incidentRate <= kpis.targets.incidentRate ? 'good' : 'critical'\n            )}`}>\n              Max: {kpis.targets.incidentRate}%\n            </Text>\n          </View>\n          <View className=\"h-2 bg-gray-300 rounded-full overflow-hidden\">\n            <View\n              className=\"h-full bg-red-500\"\n              style={{\n                width: `${Math.min((kpis.kpis.incidentRate / kpis.targets.incidentRate) * 100, 100)}%`,\n              }}\n            />\n          </View>\n        </View>\n\n        {/* Info */}\n        <View className=\"bg-blue-50 rounded-lg p-4 border border-blue-200\">\n          <Text className=\"text-sm text-blue-900 leading-5\">\n            <Text className=\"font-bold\">ℹ️ Probation Info: </Text>\n            You're in your probation period. Maintain all KPIs above the targets to successfully complete probation and earn a badge.\n          </Text>\n        </View>\n      </View>\n    </ScrollView>\n  );\n}\n
