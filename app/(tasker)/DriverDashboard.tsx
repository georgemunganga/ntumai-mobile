import React, { useEffect, useState } from 'react';\nimport {\n  View,\n  Text,\n  TouchableOpacity,\n  ScrollView,\n  Image,\n  FlatList,\n  ActivityIndicator,\n  Switch,\n} from 'react-native';\nimport { useRouter } from 'expo-router';\nimport { useAuthStore, useDriverStore } from '../../src/store';\nimport { Feather } from '@expo/vector-icons';\n\nexport default function DriverDashboard() {\n  const router = useRouter();\n  const { user } = useAuthStore();\n  const {\n    isOnline,\n    setOnlineStatus,\n    activeOrder,\n    availableOrders,\n    earnings,\n    stats,\n    goOnlineAsync,\n    goOfflineAsync,\n    fetchAvailableJobs,\n    fetchEarnings,\n    fetchStats,\n    isLoading,\n  } = useDriverStore();\n\n  const [refreshing, setRefreshing] = useState(false);\n\n  useEffect(() => {\n    if (user?.id) {\n      fetchEarnings(user.id, 'today');\n      fetchStats(user.id);\n    }\n  }, [user]);\n\n  const handleToggleOnline = async () => {\n    if (user?.id) {\n      if (isOnline) {\n        await goOfflineAsync(user.id);\n      } else {\n        await goOnlineAsync(user.id);\n      }\n    }\n  };\n\n  const handleRefresh = async () => {\n    setRefreshing(true);\n    if (user?.id) {\n      await fetchAvailableJobs(user.id, 0, 0); // Mock location\n      await fetchEarnings(user.id, 'today');\n      await fetchStats(user.id);\n    }\n    setRefreshing(false);\n  };\n\n  return (\n    <ScrollView className=\"flex-1 bg-gray-50\">\n      {/* Header with Status Toggle */}\n      <View className=\"bg-white px-6 py-6 border-b border-gray-200\">\n        <View className=\"flex-row items-center justify-between mb-4\">\n          <View>\n            <Text className=\"text-sm text-gray-600\">Welcome back</Text>\n            <Text className=\"text-2xl font-bold text-gray-900\">{user?.firstName}</Text>\n          </View>\n          <TouchableOpacity onPress={() => router.push('/(tasker)/Profile')}>\n            <Image\n              source={{ uri: user?.avatar }}\n              className=\"w-12 h-12 rounded-full\"\n            />\n          </TouchableOpacity>\n        </View>\n\n        {/* Online Status Toggle */}\n        <View className=\"bg-gradient-to-r from-green-50 to-blue-50 rounded-lg p-4 flex-row items-center justify-between\">\n          <View>\n            <Text className=\"text-gray-600 text-sm mb-1\">Status</Text>\n            <Text className={`text-lg font-bold ${\n              isOnline ? 'text-green-600' : 'text-gray-600'\n            }`}>\n              {isOnline ? 'ðŸŸ¢ Online' : 'âš« Offline'}\n            </Text>\n          </View>\n          <Switch\n            value={isOnline}\n            onValueChange={handleToggleOnline}\n            disabled={isLoading}\n            trackColor={{ false: '#D1D5DB', true: '#86EFAC' }}\n            thumbColor={isOnline ? '#16A34A' : '#9CA3AF'}\n          />\n        </View>\n      </View>\n\n      {/* Earnings Card */}\n      <View className=\"px-6 py-6\">\n        <Text className=\"text-lg font-bold text-gray-900 mb-4\">Today's Earnings</Text>\n        <View className=\"bg-gradient-to-br from-green-600 to-green-700 rounded-2xl p-6\">\n          <View className=\"flex-row items-center justify-between mb-4\">\n            <View>\n              <Text className=\"text-green-100 text-sm mb-1\">Total Earned</Text>\n              <Text className=\"text-4xl font-bold text-white\">{earnings.today}K</Text>\n            </View>\n            <View className=\"w-16 h-16 bg-white/20 rounded-full items-center justify-center\">\n              <Feather name=\"trending-up\" size={32} color=\"white\" />\n            </View>\n          </View>\n          <View className=\"flex-row items-center justify-between pt-4 border-t border-green-500\">\n            <View>\n              <Text className=\"text-green-100 text-xs\">This Week</Text>\n              <Text className=\"text-white font-bold\">{earnings.week}K</Text>\n            </View>\n            <View>\n              <Text className=\"text-green-100 text-xs\">This Month</Text>\n              <Text className=\"text-white font-bold\">{earnings.month}K</Text>\n            </View>\n          </View>\n        </View>\n      </View>\n\n      {/* Stats */}\n      {stats && (\n        <View className=\"px-6 py-6\">\n          <Text className=\"text-lg font-bold text-gray-900 mb-4\">Your Stats</Text>\n          <View className=\"gap-3\">\n            <View className=\"bg-white rounded-lg p-4 flex-row items-center border border-gray-200\">\n              <View className=\"w-12 h-12 bg-blue-100 rounded-lg items-center justify-center mr-4\">\n                <Feather name=\"package\" size={24} color=\"#2563EB\" />\n              </View>\n              <View className=\"flex-1\">\n                <Text className=\"text-gray-600 text-sm\">Total Deliveries</Text>\n                <Text className=\"text-2xl font-bold text-gray-900\">{stats.totalDeliveries}</Text>\n              </View>\n            </View>\n\n            <View className=\"bg-white rounded-lg p-4 flex-row items-center border border-gray-200\">\n              <View className=\"w-12 h-12 bg-yellow-100 rounded-lg items-center justify-center mr-4\">\n                <Feather name=\"star\" size={24} color=\"#FCD34D\" />\n              </View>\n              <View className=\"flex-1\">\n                <Text className=\"text-gray-600 text-sm\">Average Rating</Text>\n                <Text className=\"text-2xl font-bold text-gray-900\">{stats.averageRating}</Text>\n              </View>\n            </View>\n\n            <View className=\"bg-white rounded-lg p-4 flex-row items-center border border-gray-200\">\n              <View className=\"w-12 h-12 bg-green-100 rounded-lg items-center justify-center mr-4\">\n                <Feather name=\"check-circle\" size={24} color=\"#16A34A\" />\n              </View>\n              <View className=\"flex-1\">\n                <Text className=\"text-gray-600 text-sm\">Completion Rate</Text>\n                <Text className=\"text-2xl font-bold text-gray-900\">{stats.completionRate}%</Text>\n              </View>\n            </View>\n          </View>\n        </View>\n      )}\n\n      {/* Active Job */}\n      {activeOrder && (\n        <View className=\"px-6 py-6\">\n          <Text className=\"text-lg font-bold text-gray-900 mb-4\">Active Delivery</Text>\n          <TouchableOpacity\n            onPress={() => router.push(`/(tasker)/DeliveryDetail?orderId=${activeOrder.id}`)}\n            className=\"bg-white rounded-lg p-4 border-2 border-green-600\"\n          >\n            <View className=\"flex-row items-center justify-between mb-3\">\n              <Text className=\"text-lg font-bold text-gray-900\">Order #{activeOrder.id.slice(-4)}</Text>\n              <View className=\"bg-green-100 rounded-full px-3 py-1\">\n                <Text className=\"text-green-700 font-bold text-xs\">IN PROGRESS</Text>\n              </View>\n            </View>\n            <Text className=\"text-gray-600 text-sm mb-3\">Tap to view details and navigate</Text>\n            <View className=\"flex-row items-center justify-between pt-3 border-t border-gray-200\">\n              <View>\n                <Text className=\"text-gray-600 text-xs\">Delivery Fee</Text>\n                <Text className=\"text-lg font-bold text-green-600\">{activeOrder.deliveryFee}K</Text>\n              </View>\n              <Feather name=\"chevron-right\" size={24} color=\"#9CA3AF\" />\n            </View>\n          </TouchableOpacity>\n        </View>\n      )}\n\n      {/* Available Jobs */}\n      {isOnline && availableOrders.length > 0 && (\n        <View className=\"px-6 py-6\">\n          <View className=\"flex-row items-center justify-between mb-4\">\n            <Text className=\"text-lg font-bold text-gray-900\">Available Jobs</Text>\n            <TouchableOpacity onPress={handleRefresh}>\n              {refreshing ? (\n                <ActivityIndicator color=\"#16A34A\" />\n              ) : (\n                <Feather name=\"refresh-cw\" size={20} color=\"#16A34A\" />\n              )}\n            </TouchableOpacity>\n          </View>\n\n          <FlatList\n            data={availableOrders.slice(0, 5)}\n            keyExtractor={(item) => item.id}\n            scrollEnabled={false}\n            renderItem={({ item }) => (\n              <TouchableOpacity\n                onPress={() => router.push(`/(tasker)/JobDetail?jobId=${item.id}`)}\n                className=\"bg-white rounded-lg p-4 mb-3 border border-gray-200\"\n              >\n                <View className=\"flex-row items-start justify-between mb-2\">\n                  <View className=\"flex-1\">\n                    <Text className=\"text-lg font-bold text-gray-900 mb-1\">\n                      {item.title}\n                    </Text>\n                    <Text className=\"text-gray-600 text-sm line-clamp-2\">\n                      {item.description}\n                    </Text>\n                  </View>\n                  <View className=\"bg-green-100 rounded-lg px-3 py-1 ml-2\">\n                    <Text className=\"text-green-700 font-bold\">{item.estimatedPay}K</Text>\n                  </View>\n                </View>\n                <View className=\"flex-row items-center justify-between pt-3 border-t border-gray-200\">\n                  <View className=\"flex-row items-center gap-4\">\n                    <View className=\"flex-row items-center\">\n                      <Feather name=\"map-pin\" size={14} color=\"#6B7280\" />\n                      <Text className=\"text-gray-600 text-xs ml-1\">2.5 km away</Text>\n                    </View>\n                    <View className=\"flex-row items-center\">\n                      <Feather name=\"clock\" size={14} color=\"#6B7280\" />\n                      <Text className=\"text-gray-600 text-xs ml-1\">{item.estimatedTime}</Text>\n                    </View>\n                  </View>\n                  <Feather name=\"chevron-right\" size={20} color=\"#9CA3AF\" />\n                </View>\n              </TouchableOpacity>\n            )}\n          />\n\n          {availableOrders.length > 5 && (\n            <TouchableOpacity\n              onPress={() => router.push('/(tasker)/AvailableJobs')}\n              className=\"bg-green-600 rounded-lg py-3 mt-2\"\n            >\n              <Text className=\"text-white text-center font-bold\">View All {availableOrders.length} Jobs</Text>\n            </TouchableOpacity>\n          )}\n        </View>\n      )}\n\n      {/* Empty State */}\n      {!isOnline && (\n        <View className=\"px-6 py-12 items-center\">\n          <Feather name=\"pause-circle\" size={64} color=\"#D1D5DB\" />\n          <Text className=\"text-2xl font-bold text-gray-900 mt-4\">You're Offline</Text>\n          <Text className=\"text-gray-600 text-center mt-2\">\n            Go online to see available jobs and start earning\n          </Text>\n        </View>\n      )}\n\n      {/* Quick Actions */}\n      <View className=\"px-6 py-6\">\n        <Text className=\"text-lg font-bold text-gray-900 mb-4\">Quick Actions</Text>\n        <View className=\"gap-3\">\n          <TouchableOpacity\n            onPress={() => router.push('/(tasker)/Earnings')}\n            className=\"bg-white rounded-lg p-4 flex-row items-center border border-gray-200\"\n          >\n            <View className=\"w-12 h-12 bg-green-100 rounded-lg items-center justify-center mr-4\">\n              <Feather name=\"dollar-sign\" size={24} color=\"#16A34A\" />\n            </View>\n            <View className=\"flex-1\">\n              <Text className=\"text-lg font-bold text-gray-900\">Earnings</Text>\n              <Text className=\"text-gray-600 text-sm\">View detailed earnings</Text>\n            </View>\n            <Feather name=\"chevron-right\" size={20} color=\"#9CA3AF\" />\n          </TouchableOpacity>\n\n          <TouchableOpacity\n            onPress={() => router.push('/(tasker)/DeliveryHistory')}\n            className=\"bg-white rounded-lg p-4 flex-row items-center border border-gray-200\"\n          >\n            <View className=\"w-12 h-12 bg-blue-100 rounded-lg items-center justify-center mr-4\">\n              <Feather name=\"list\" size={24} color=\"#2563EB\" />\n            </View>\n            <View className=\"flex-1\">\n              <Text className=\"text-lg font-bold text-gray-900\">Delivery History</Text>\n              <Text className=\"text-gray-600 text-sm\">View past deliveries</Text>\n            </View>\n            <Feather name=\"chevron-right\" size={20} color=\"#9CA3AF\" />\n          </TouchableOpacity>\n        </View>\n      </View>\n    </ScrollView>\n  );\n}\n
