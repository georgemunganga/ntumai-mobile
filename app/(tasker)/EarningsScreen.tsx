import React, { useEffect, useState } from 'react';\nimport {\n  View,\n  Text,\n  TouchableOpacity,\n  ScrollView,\n  FlatList,\n  ActivityIndicator,\n} from 'react-native';\nimport { useRouter } from 'expo-router';\nimport { useAuthStore, useDriverStore } from '../../src/store';\nimport { Feather } from '@expo/vector-icons';\n\ntype Period = 'today' | 'week' | 'month';\n\nexport default function EarningsScreen() {\n  const router = useRouter();\n  const { user } = useAuthStore();\n  const { earnings, fetchEarnings, isLoading } = useDriverStore();\n  const [selectedPeriod, setSelectedPeriod] = useState<Period>('today');\n  const [transactions, setTransactions] = useState<any[]>([\n    {\n      id: '1',\n      type: 'earning',\n      amount: 45,\n      description: 'Food delivery - Order #1234',\n      timestamp: new Date(Date.now() - 2 * 60 * 60 * 1000),\n      status: 'completed',\n    },\n    {\n      id: '2',\n      type: 'earning',\n      amount: 30,\n      description: 'Package delivery',\n      timestamp: new Date(Date.now() - 4 * 60 * 60 * 1000),\n      status: 'completed',\n    },\n    {\n      id: '3',\n      type: 'earning',\n      amount: 25,\n      description: 'Shopping task',\n      timestamp: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000),\n      status: 'completed',\n    },\n  ]);\n\n  useEffect(() => {\n    if (user?.id) {\n      fetchEarnings(user.id, selectedPeriod);\n    }\n  }, [user, selectedPeriod]);\n\n  const currentEarning = earnings[selectedPeriod];\n\n  return (\n    <View className=\"flex-1 bg-white\">\n      {/* Header */}\n      <View className=\"px-6 py-4 border-b border-gray-200 flex-row items-center\">\n        <TouchableOpacity onPress={() => router.back()} className=\"mr-4\">\n          <Feather name=\"chevron-left\" size={24} color=\"#1F2937\" />\n        </TouchableOpacity>\n        <Text className=\"text-2xl font-bold text-gray-900\">Earnings</Text>\n      </View>\n\n      <ScrollView className=\"flex-1\">\n        {/* Period Selector */}\n        <View className=\"px-6 py-6\">\n          <View className=\"flex-row gap-3\">\n            {[\n              { id: 'today', label: 'Today' },\n              { id: 'week', label: 'This Week' },\n              { id: 'month', label: 'This Month' },\n            ].map(period => (\n              <TouchableOpacity\n                key={period.id}\n                onPress={() => setSelectedPeriod(period.id as Period)}\n                className={`flex-1 rounded-lg py-3 ${\n                  selectedPeriod === period.id\n                    ? 'bg-green-600'\n                    : 'bg-gray-100'\n                }`}\n              >\n                <Text className={`text-center font-bold ${\n                  selectedPeriod === period.id ? 'text-white' : 'text-gray-700'\n                }`}>\n                  {period.label}\n                </Text>\n              </TouchableOpacity>\n            ))}\n          </View>\n        </View>\n\n        {/* Earnings Card */}\n        <View className=\"px-6 py-6\">\n          <View className=\"bg-gradient-to-br from-green-600 to-green-700 rounded-2xl p-8\">\n            <Text className=\"text-green-100 text-sm mb-2\">Total Earnings</Text>\n            <Text className=\"text-5xl font-bold text-white mb-6\">{currentEarning}K</Text>\n            <View className=\"flex-row items-center justify-between pt-6 border-t border-green-500\">\n              <View>\n                <Text className=\"text-green-100 text-xs mb-1\">Completed Jobs</Text>\n                <Text className=\"text-white font-bold text-lg\">12</Text>\n              </View>\n              <View>\n                <Text className=\"text-green-100 text-xs mb-1\">Avg per Job</Text>\n                <Text className=\"text-white font-bold text-lg\">{Math.round(currentEarning / 12)}K</Text>\n              </View>\n              <View>\n                <Text className=\"text-green-100 text-xs mb-1\">Rating</Text>\n                <View className=\"flex-row items-center\">\n                  <Feather name=\"star\" size={16} color=\"#FCD34D\" fill=\"#FCD34D\" />\n                  <Text className=\"text-white font-bold text-lg ml-1\">4.8</Text>\n                </View>\n              </View>\n            </View>\n          </View>\n        </View>\n\n        {/* Breakdown */}\n        <View className=\"px-6 py-6 border-b border-gray-200\">\n          <Text className=\"text-lg font-bold text-gray-900 mb-4\">Breakdown</Text>\n          <View className=\"gap-3\">\n            <View className=\"flex-row items-center justify-between\">\n              <View className=\"flex-row items-center\">\n                <View className=\"w-10 h-10 bg-blue-100 rounded-full items-center justify-center mr-3\">\n                  <Feather name=\"package\" size={16} color=\"#2563EB\" />\n                </View>\n                <View>\n                  <Text className=\"text-gray-900 font-semibold\">Deliveries</Text>\n                  <Text className=\"text-gray-600 text-xs\">8 completed</Text>\n                </View>\n              </View>\n              <Text className=\"text-2xl font-bold text-gray-900\">280K</Text>\n            </View>\n\n            <View className=\"flex-row items-center justify-between\">\n              <View className=\"flex-row items-center\">\n                <View className=\"w-10 h-10 bg-purple-100 rounded-full items-center justify-center mr-3\">\n                  <Feather name=\"check-square\" size={16} color=\"#7C3AED\" />\n                </View>\n                <View>\n                  <Text className=\"text-gray-900 font-semibold\">Tasks</Text>\n                  <Text className=\"text-gray-600 text-xs\">4 completed</Text>\n                </View>\n              </View>\n              <Text className=\"text-2xl font-bold text-gray-900\">80K</Text>\n            </View>\n          </View>\n        </View>\n\n        {/* Recent Transactions */}\n        <View className=\"px-6 py-6\">\n          <Text className=\"text-lg font-bold text-gray-900 mb-4\">Recent Transactions</Text>\n          {isLoading ? (\n            <ActivityIndicator color=\"#16A34A\" />\n          ) : (\n            <FlatList\n              data={transactions}\n              keyExtractor={(item) => item.id}\n              scrollEnabled={false}\n              renderItem={({ item }) => (\n                <View className=\"flex-row items-center justify-between py-4 border-b border-gray-100\">\n                  <View className=\"flex-row items-center flex-1\">\n                    <View className={`w-10 h-10 rounded-full items-center justify-center mr-3 ${\n                      item.type === 'earning' ? 'bg-green-100' : 'bg-red-100'\n                    }`}>\n                      <Feather\n                        name={item.type === 'earning' ? 'arrow-down-left' : 'arrow-up-right'}\n                        size={16}\n                        color={item.type === 'earning' ? '#16A34A' : '#EF4444'}\n                      />\n                    </View>\n                    <View className=\"flex-1\">\n                      <Text className=\"text-gray-900 font-semibold\">{item.description}</Text>\n                      <Text className=\"text-gray-600 text-xs\">\n                        {item.timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\n                      </Text>\n                    </View>\n                  </View>\n                  <Text className={`text-lg font-bold ${\n                    item.type === 'earning' ? 'text-green-600' : 'text-red-600'\n                  }`}>\n                    {item.type === 'earning' ? '+' : '-'}{item.amount}K\n                  </Text>\n                </View>\n              )}\n            />\n          )}\n        </View>\n      </ScrollView>\n\n      {/* Withdrawal Button */}\n      <View className=\"px-6 py-6 border-t border-gray-200\">\n        <TouchableOpacity className=\"bg-green-600 rounded-lg py-4\">\n          <Text className=\"text-white text-center font-bold text-lg\">Withdraw Earnings</Text>\n        </TouchableOpacity>\n      </View>\n    </View>\n  );\n}\n
