import React, { useState, useEffect } from 'react';\nimport {\n  View,\n  Text,\n  ScrollView,\n  TouchableOpacity,\n  TextInput,\n  Alert,\n  ActivityIndicator,\n} from 'react-native';\nimport { useRouter } from 'expo-router';\nimport { Ionicons } from '@expo/vector-icons';\nimport { floatMockService } from '../../src/api/mockServices.extended';\n\nconst PRESET_AMOUNTS = [10, 25, 50, 100];\n\nexport default function FloatTopUpScreen() {\n  const router = useRouter();\n  const [floatBalance, setFloatBalance] = useState<any>(null);\n  const [selectedAmount, setSelectedAmount] = useState<number | null>(null);\n  const [customAmount, setCustomAmount] = useState('');\n  const [selectedPaymentMethod, setSelectedPaymentMethod] = useState<string | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [processing, setProcessing] = useState(false);\n\n  const paymentMethods = [\n    { id: 'card', name: 'Debit/Credit Card', icon: 'card' },\n    { id: 'mobile_money', name: 'Mobile Money', icon: 'phone-portrait' },\n    { id: 'bank', name: 'Bank Transfer', icon: 'business' },\n  ];\n\n  useEffect(() => {\n    loadFloatBalance();\n  }, []);\n\n  const loadFloatBalance = async () => {\n    try {\n      const response = await floatMockService.getFloatBalance('tasker_1');\n      if (response.success) {\n        setFloatBalance(response.data);\n      }\n    } catch (error) {\n      Alert.alert('Error', 'Failed to load float balance');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const getTopUpAmount = (): number | null => {\n    if (selectedAmount) return selectedAmount;\n    if (customAmount.trim()) return parseFloat(customAmount);\n    return null;\n  };\n\n  const handleTopUp = async () => {\n    const amount = getTopUpAmount();\n\n    if (!amount || amount <= 0) {\n      Alert.alert('Error', 'Please select or enter a valid amount');\n      return;\n    }\n\n    if (!selectedPaymentMethod) {\n      Alert.alert('Error', 'Please select a payment method');\n      return;\n    }\n\n    setProcessing(true);\n    try {\n      const response = await floatMockService.topUpFloat(\n        amount,\n        selectedPaymentMethod\n      );\n      if (response.success) {\n        Alert.alert('Success', 'Float top-up completed!', [\n          {\n            text: 'OK',\n            onPress: () => {\n              setFloatBalance({\n                ...floatBalance,\n                floatBalance: response.data.newBalance,\n              });\n              setSelectedAmount(null);\n              setCustomAmount('');\n              setSelectedPaymentMethod(null);\n            },\n          },\n        ]);\n      }\n    } catch (error) {\n      Alert.alert('Error', 'Failed to process top-up');\n    } finally {\n      setProcessing(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      <View className=\"flex-1 justify-center items-center bg-white\">\n        <ActivityIndicator size=\"large\" color=\"#FF6B35\" />\n      </View>\n    );\n  }\n\n  return (\n    <ScrollView className=\"flex-1 bg-gray-50\" showsVerticalScrollIndicator={false}>\n      {/* Header */}\n      <View className=\"bg-white border-b border-gray-200 px-4 py-4\">\n        <Text className=\"text-2xl font-bold text-gray-900\">Top Up Float</Text>\n      </View>\n\n      <View className=\"px-4 py-4\">\n        {/* Current Balance */}\n        <View className=\"bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg p-6 mb-6 text-white\">\n          <Text className=\"text-white text-sm opacity-90 mb-2\">Current Float Balance</Text>\n          <Text className=\"text-white text-4xl font-bold mb-4\">\n            ₭{floatBalance?.floatBalance.toFixed(2)}\n          </Text>\n          <View className=\"flex-row justify-between\">\n            <View>\n              <Text className=\"text-white text-xs opacity-75\">Earnings</Text>\n              <Text className=\"text-white text-lg font-semibold\">\n                ₭{floatBalance?.earningsBalance.toFixed(2)}\n              </Text>\n            </View>\n            <View>\n              <Text className=\"text-white text-xs opacity-75\">Minimum Required</Text>\n              <Text className=\"text-white text-lg font-semibold\">\n                ₭{floatBalance?.minimumRequired.toFixed(2)}\n              </Text>\n            </View>\n          </View>\n        </View>\n\n        {/* Float Status */}\n        {floatBalance?.floatBalance < floatBalance?.minimumRequired && (\n          <View className=\"bg-red-50 rounded-lg p-4 mb-6 border border-red-200\">\n            <Text className=\"text-red-900 font-semibold mb-1\">⚠️ Low Float Balance</Text>\n            <Text className=\"text-red-700 text-sm\">\n              Your float is below the minimum required. Top up to continue receiving jobs.\n            </Text>\n          </View>\n        )}\n\n        {/* Preset Amounts */}\n        <Text className=\"text-lg font-bold text-gray-900 mb-3\">Quick Select</Text>\n        <View className=\"flex-row flex-wrap gap-2 mb-6\">\n          {PRESET_AMOUNTS.map((amount) => (\n            <TouchableOpacity\n              key={amount}\n              onPress={() => {\n                setSelectedAmount(amount);\n                setCustomAmount('');\n              }}\n              className={`flex-1 min-w-[45%] py-3 rounded-lg border-2 ${\n                selectedAmount === amount\n                  ? 'bg-blue-500 border-blue-600'\n                  : 'bg-white border-gray-200'\n              }`}\n            >\n              <Text\n                className={`text-center font-bold ${\n                  selectedAmount === amount\n                    ? 'text-white'\n                    : 'text-gray-900'\n                }`}\n              >\n                ₭{amount}\n              </Text>\n            </TouchableOpacity>\n          ))}\n        </View>\n\n        {/* Custom Amount */}\n        <Text className=\"text-lg font-bold text-gray-900 mb-3\">Custom Amount</Text>\n        <TextInput\n          value={customAmount}\n          onChangeText={(text) => {\n            setCustomAmount(text);\n            setSelectedAmount(null);\n          }}\n          placeholder=\"Enter amount\"\n          keyboardType=\"decimal-pad\"\n          className=\"bg-white rounded-lg px-4 py-3 text-gray-900 border border-gray-200 mb-6\"\n          placeholderTextColor=\"#999\"\n        />\n\n        {/* Payment Methods */}\n        <Text className=\"text-lg font-bold text-gray-900 mb-3\">Payment Method</Text>\n        {paymentMethods.map((method) => (\n          <TouchableOpacity\n            key={method.id}\n            onPress={() => setSelectedPaymentMethod(method.id)}\n            className={`flex-row items-center p-4 rounded-lg mb-3 border-2 ${\n              selectedPaymentMethod === method.id\n                ? 'bg-blue-50 border-blue-500'\n                : 'bg-white border-gray-200'\n            }`}\n          >\n            <Ionicons\n              name={method.icon as any}\n              size={24}\n              color={selectedPaymentMethod === method.id ? '#3B82F6' : '#6B7280'}\n            />\n            <Text\n              className={`ml-3 font-semibold ${\n                selectedPaymentMethod === method.id\n                  ? 'text-blue-600'\n                  : 'text-gray-900'\n              }`}\n            >\n              {method.name}\n            </Text>\n          </TouchableOpacity>\n        ))}\n\n        {/* Summary */}\n        {getTopUpAmount() && (\n          <View className=\"bg-gray-100 rounded-lg p-4 mb-6\">\n            <View className=\"flex-row justify-between mb-2\">\n              <Text className=\"text-gray-600\">Amount to Top Up</Text>\n              <Text className=\"text-gray-900 font-semibold\">\n                ₭{getTopUpAmount()?.toFixed(2)}\n              </Text>\n            </View>\n            <View className=\"flex-row justify-between\">\n              <Text className=\"text-gray-600\">New Balance</Text>\n              <Text className=\"text-gray-900 font-bold\">\n                ₭{(floatBalance?.floatBalance + (getTopUpAmount() || 0)).toFixed(2)}\n              </Text>\n            </View>\n          </View>\n        )}\n      </View>\n\n      {/* Button */}\n      <View className=\"px-4 pb-6\">\n        <TouchableOpacity\n          onPress={handleTopUp}\n          disabled={processing || !getTopUpAmount() || !selectedPaymentMethod}\n          className={`py-4 rounded-lg ${\n            processing || !getTopUpAmount() || !selectedPaymentMethod\n              ? 'bg-gray-300'\n              : 'bg-blue-500'\n          }`}\n        >\n          <Text className=\"text-center text-white font-bold text-lg\">\n            {processing ? 'Processing...' : 'Top Up Float'}\n          </Text>\n        </TouchableOpacity>\n      </View>\n    </ScrollView>\n  );\n}\n
