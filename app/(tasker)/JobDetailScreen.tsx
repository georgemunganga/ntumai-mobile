import React, { useEffect, useState } from 'react';\nimport {\n  View,\n  Text,\n  TouchableOpacity,\n  ScrollView,\n  ActivityIndicator,\n  Alert,\n} from 'react-native';\nimport { useRouter, useLocalSearchParams } from 'expo-router';\nimport { useAuthStore, useDriverStore } from '../../src/store';\nimport { Feather } from '@expo/vector-icons';\n\nexport default function JobDetailScreen() {\n  const router = useRouter();\n  const { jobId } = useLocalSearchParams();\n  const { user } = useAuthStore();\n  const { availableOrders, acceptJob, isLoading } = useDriverStore();\n  const [job, setJob] = useState<any>(null);\n  const [isAccepting, setIsAccepting] = useState(false);\n\n  useEffect(() => {\n    if (jobId) {\n      const foundJob = availableOrders.find(j => j.id === jobId);\n      setJob(foundJob);\n    }\n  }, [jobId, availableOrders]);\n\n  const handleAcceptJob = async () => {\n    if (!user?.id || !job) return;\n\n    setIsAccepting(true);\n    try {\n      await acceptJob(user.id, job.id, job.type);\n      Alert.alert('Success', 'Job accepted! Navigate to the pickup location.');\n      router.replace(`/(tasker)/DeliveryDetail?orderId=${job.id}`);\n    } catch (error: any) {\n      Alert.alert('Error', error.message || 'Failed to accept job');\n    } finally {\n      setIsAccepting(false);\n    }\n  };\n\n  if (!job) {\n    return (\n      <View className=\"flex-1 bg-white items-center justify-center\">\n        <ActivityIndicator size=\"large\" color=\"#16A34A\" />\n      </View>\n    );\n  }\n\n  return (\n    <View className=\"flex-1 bg-white\">\n      {/* Header */}\n      <View className=\"px-6 py-4 border-b border-gray-200 flex-row items-center\">\n        <TouchableOpacity onPress={() => router.back()} className=\"mr-4\">\n          <Feather name=\"chevron-left\" size={24} color=\"#1F2937\" />\n        </TouchableOpacity>\n        <View className=\"flex-1\">\n          <Text className=\"text-2xl font-bold text-gray-900\">Job Details</Text>\n        </View>\n      </View>\n\n      <ScrollView className=\"flex-1\">\n        {/* Job Type Badge */}\n        <View className=\"px-6 py-6\">\n          <View className={`inline-flex px-4 py-2 rounded-full mb-4 ${\n            job.type === 'delivery' ? 'bg-blue-100' : 'bg-purple-100'\n          }`}>\n            <Text className={`font-bold ${\n              job.type === 'delivery' ? 'text-blue-700' : 'text-purple-700'\n            }`}>\n              {job.type === 'delivery' ? 'ðŸšš DELIVERY' : 'âœ“ TASK'}\n            </Text>\n          </View>\n\n          {/* Title and Description */}\n          <Text className=\"text-3xl font-bold text-gray-900 mb-2\">{job.title}</Text>\n          <Text className=\"text-gray-600 text-lg mb-6\">{job.description}</Text>\n        </View>\n\n        {/* Earnings Card */}\n        <View className=\"px-6 py-6 bg-gradient-to-r from-green-50 to-green-100 border-b border-gray-200\">\n          <View className=\"flex-row items-center justify-between\">\n            <View>\n              <Text className=\"text-gray-600 text-sm mb-1\">Estimated Earnings</Text>\n              <Text className=\"text-4xl font-bold text-green-600\">{job.estimatedPay}K</Text>\n            </View>\n            <View>\n              <Text className=\"text-gray-600 text-sm mb-1 text-right\">Est. Time</Text>\n              <Text className=\"text-2xl font-bold text-gray-900\">{job.estimatedTime}</Text>\n            </View>\n          </View>\n        </View>\n\n        {/* Locations */}\n        <View className=\"px-6 py-6 border-b border-gray-200\">\n          <Text className=\"text-lg font-bold text-gray-900 mb-4\">Locations</Text>\n\n          {/* Pickup */}\n          <View className=\"mb-6\">\n            <View className=\"flex-row items-center mb-2\">\n              <View className=\"w-8 h-8 bg-green-100 rounded-full items-center justify-center mr-3\">\n                <Feather name=\"map-pin\" size={16} color=\"#16A34A\" />\n              </View>\n              <Text className=\"text-gray-600 text-sm font-semibold\">Pickup Location</Text>\n            </View>\n            <View className=\"bg-gray-50 rounded-lg p-4 ml-11\">\n              <Text className=\"text-gray-900 font-semibold mb-1\">{job.pickupLocation}</Text>\n              <Text className=\"text-gray-600 text-sm\">Tap to navigate</Text>\n            </View>\n          </View>\n\n          {/* Dropoff */}\n          <View>\n            <View className=\"flex-row items-center mb-2\">\n              <View className=\"w-8 h-8 bg-blue-100 rounded-full items-center justify-center mr-3\">\n                <Feather name=\"map-pin\" size={16} color=\"#2563EB\" />\n              </View>\n              <Text className=\"text-gray-600 text-sm font-semibold\">Dropoff Location</Text>\n            </View>\n            <View className=\"bg-gray-50 rounded-lg p-4 ml-11\">\n              <Text className=\"text-gray-900 font-semibold mb-1\">{job.dropoffLocation}</Text>\n              <Text className=\"text-gray-600 text-sm\">Tap to navigate</Text>\n            </View>\n          </View>\n        </View>\n\n        {/* Additional Details */}\n        <View className=\"px-6 py-6 border-b border-gray-200\">\n          <Text className=\"text-lg font-bold text-gray-900 mb-4\">Additional Details</Text>\n          <View className=\"gap-3\">\n            <View className=\"flex-row items-center justify-between\">\n              <View className=\"flex-row items-center\">\n                <Feather name=\"navigation\" size={16} color=\"#6B7280\" />\n                <Text className=\"text-gray-600 ml-3\">Distance</Text>\n              </View>\n              <Text className=\"text-gray-900 font-semibold\">{job.distance || '2.5 km'}</Text>\n            </View>\n            <View className=\"flex-row items-center justify-between\">\n              <View className=\"flex-row items-center\">\n                <Feather name=\"clock\" size={16} color=\"#6B7280\" />\n                <Text className=\"text-gray-600 ml-3\">Estimated Duration</Text>\n              </View>\n              <Text className=\"text-gray-900 font-semibold\">{job.estimatedTime}</Text>\n            </View>\n            <View className=\"flex-row items-center justify-between\">\n              <View className=\"flex-row items-center\">\n                <Feather name=\"user\" size={16} color=\"#6B7280\" />\n                <Text className=\"text-gray-600 ml-3\">Customer Rating</Text>\n              </View>\n              <View className=\"flex-row items-center\">\n                <Feather name=\"star\" size={14} color=\"#FCD34D\" fill=\"#FCD34D\" />\n                <Text className=\"text-gray-900 font-semibold ml-1\">4.8</Text>\n              </View>\n            </View>\n          </View>\n        </View>\n\n        {/* Requirements */}\n        <View className=\"px-6 py-6\">\n          <Text className=\"text-lg font-bold text-gray-900 mb-4\">Requirements</Text>\n          <View className=\"gap-2\">\n            <View className=\"flex-row items-center\">\n              <Feather name=\"check\" size={16} color=\"#16A34A\" />\n              <Text className=\"text-gray-700 ml-3\">Professional and courteous</Text>\n            </View>\n            <View className=\"flex-row items-center\">\n              <Feather name=\"check\" size={16} color=\"#16A34A\" />\n              <Text className=\"text-gray-700 ml-3\">On-time delivery</Text>\n            </View>\n            <View className=\"flex-row items-center\">\n              <Feather name=\"check\" size={16} color=\"#16A34A\" />\n              <Text className=\"text-gray-700 ml-3\">Keep items safe and secure</Text>\n            </View>\n          </View>\n        </View>\n      </ScrollView>\n\n      {/* Action Buttons */}\n      <View className=\"px-6 py-6 border-t border-gray-200 gap-3\">\n        <TouchableOpacity\n          onPress={handleAcceptJob}\n          disabled={isAccepting || isLoading}\n          className={`rounded-lg py-4 flex-row items-center justify-center ${\n            isAccepting || isLoading ? 'bg-gray-300' : 'bg-green-600'\n          }`}\n        >\n          {isAccepting || isLoading ? (\n            <ActivityIndicator color=\"white\" />\n          ) : (\n            <>\n              <Feather name=\"check-circle\" size={20} color=\"white\" />\n              <Text className=\"text-white text-center font-bold text-lg ml-2\">Accept Job</Text>\n            </>\n          )}\n        </TouchableOpacity>\n\n        <TouchableOpacity\n          onPress={() => router.back()}\n          className=\"bg-gray-100 rounded-lg py-4\"\n        >\n          <Text className=\"text-gray-900 text-center font-bold text-lg\">Decline</Text>\n        </TouchableOpacity>\n      </View>\n    </View>\n  );\n}\n
