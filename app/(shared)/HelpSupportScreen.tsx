import React, { useState, useEffect } from 'react';\nimport {\n  View,\n  Text,\n  ScrollView,\n  TouchableOpacity,\n  TextInput,\n  Alert,\n  ActivityIndicator,\n} from 'react-native';\nimport { Ionicons } from '@expo/vector-icons';\nimport { supportMockService } from '../../src/api/mockServices.extended';\n\ninterface FAQItem {\n  id: string;\n  question: string;\n  answer: string;\n  category: string;\n}\n\ninterface Ticket {\n  id: string;\n  subject: string;\n  status: string;\n  createdAt: string;\n}\n\nexport default function HelpSupportScreen() {\n  const [activeTab, setActiveTab] = useState<'faq' | 'tickets' | 'contact'>('faq');\n  const [faqs, setFaqs] = useState<FAQItem[]>([]);\n  const [tickets, setTickets] = useState<Ticket[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [expandedFAQ, setExpandedFAQ] = useState<string | null>(null);\n  const [searchQuery, setSearchQuery] = useState('');\n  const [showNewTicketForm, setShowNewTicketForm] = useState(false);\n  const [ticketSubject, setTicketSubject] = useState('');\n  const [ticketDescription, setTicketDescription] = useState('');\n\n  useEffect(() => {\n    loadData();\n  }, []);\n\n  const loadData = async () => {\n    try {\n      const [faqResponse, ticketsResponse] = await Promise.all([\n        supportMockService.getFAQ(),\n        supportMockService.getTickets('user_1'),\n      ]);\n\n      if (faqResponse.success) {\n        setFaqs(faqResponse.data);\n      }\n      if (ticketsResponse.success) {\n        setTickets(ticketsResponse.data);\n      }\n    } catch (error) {\n      Alert.alert('Error', 'Failed to load support data');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleCreateTicket = async () => {\n    if (!ticketSubject.trim() || !ticketDescription.trim()) {\n      Alert.alert('Error', 'Please fill in all fields');\n      return;\n    }\n\n    try {\n      const response = await supportMockService.createTicket({\n        subject: ticketSubject,\n        description: ticketDescription,\n      });\n      if (response.success) {\n        setTickets([...tickets, response.data]);\n        setTicketSubject('');\n        setTicketDescription('');\n        setShowNewTicketForm(false);\n        Alert.alert('Success', 'Support ticket created');\n      }\n    } catch (error) {\n      Alert.alert('Error', 'Failed to create ticket');\n    }\n  };\n\n  const filteredFAQs = faqs.filter(\n    (faq) =>\n      faq.question.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      faq.answer.toLowerCase().includes(searchQuery.toLowerCase())\n  );\n\n  if (loading) {\n    return (\n      <View className=\"flex-1 justify-center items-center bg-white\">\n        <ActivityIndicator size=\"large\" color=\"#FF6B35\" />\n      </View>\n    );\n  }\n\n  return (\n    <View className=\"flex-1 bg-gray-50\">\n      {/* Header */}\n      <View className=\"bg-white border-b border-gray-200 px-4 py-4\">\n        <Text className=\"text-2xl font-bold text-gray-900\">Help & Support</Text>\n      </View>\n\n      {/* Tabs */}\n      <View className=\"flex-row bg-white border-b border-gray-200\">\n        {(['faq', 'tickets', 'contact'] as const).map((tab) => (\n          <TouchableOpacity\n            key={tab}\n            onPress={() => setActiveTab(tab)}\n            className={`flex-1 py-3 border-b-2 ${\n              activeTab === tab ? 'border-blue-500' : 'border-transparent'\n            }`}\n          >\n            <Text\n              className={`text-center font-semibold ${\n                activeTab === tab ? 'text-blue-500' : 'text-gray-600'\n              }`}\n            >\n              {tab === 'faq' ? 'FAQ' : tab === 'tickets' ? 'Tickets' : 'Contact'}\n            </Text>\n          </TouchableOpacity>\n        ))}\n      </View>\n\n      <ScrollView className=\"flex-1 px-4 py-4\" showsVerticalScrollIndicator={false}>\n        {/* FAQ Tab */}\n        {activeTab === 'faq' && (\n          <>\n            <TextInput\n              value={searchQuery}\n              onChangeText={setSearchQuery}\n              placeholder=\"Search FAQ...\"\n              className=\"bg-white rounded-lg px-4 py-3 text-gray-900 mb-4 border border-gray-200\"\n              placeholderTextColor=\"#999\"\n            />\n\n            {filteredFAQs.length === 0 ? (\n              <View className=\"items-center py-8\">\n                <Text className=\"text-gray-600\">No FAQs found</Text>\n              </View>\n            ) : (\n              filteredFAQs.map((faq) => (\n                <TouchableOpacity\n                  key={faq.id}\n                  onPress={() =>\n                    setExpandedFAQ(expandedFAQ === faq.id ? null : faq.id)\n                  }\n                  className=\"bg-white rounded-lg p-4 mb-3 border border-gray-200\"\n                >\n                  <View className=\"flex-row justify-between items-start\">\n                    <View className=\"flex-1 pr-4\">\n                      <Text className=\"font-semibold text-gray-900\">\n                        {faq.question}\n                      </Text>\n                      <Text className=\"text-xs text-gray-500 mt-1\">\n                        {faq.category}\n                      </Text>\n                    </View>\n                    <Ionicons\n                      name={\n                        expandedFAQ === faq.id ? 'chevron-up' : 'chevron-down'\n                      }\n                      size={20}\n                      color=\"#6B7280\"\n                    />\n                  </View>\n\n                  {expandedFAQ === faq.id && (\n                    <Text className=\"text-gray-700 mt-3 leading-5\">\n                      {faq.answer}\n                    </Text>\n                  )}\n                </TouchableOpacity>\n              ))\n            )}\n          </>\n        )}\n\n        {/* Tickets Tab */}\n        {activeTab === 'tickets' && (\n          <>\n            {showNewTicketForm ? (\n              <View className=\"bg-white rounded-lg p-4 mb-4 border border-blue-200\">\n                <Text className=\"text-lg font-bold text-gray-900 mb-3\">\n                  Create Support Ticket\n                </Text>\n                <TextInput\n                  value={ticketSubject}\n                  onChangeText={setTicketSubject}\n                  placeholder=\"Subject\"\n                  className=\"bg-gray-100 rounded-lg px-4 py-3 text-gray-900 mb-3\"\n                  placeholderTextColor=\"#999\"\n                />\n                <TextInput\n                  value={ticketDescription}\n                  onChangeText={setTicketDescription}\n                  placeholder=\"Describe your issue...\"\n                  multiline\n                  numberOfLines={4}\n                  className=\"bg-gray-100 rounded-lg px-4 py-3 text-gray-900 mb-3\"\n                  placeholderTextColor=\"#999\"\n                />\n                <View className=\"flex-row gap-2\">\n                  <TouchableOpacity\n                    onPress={handleCreateTicket}\n                    className=\"flex-1 bg-blue-500 py-2 rounded-lg\"\n                  >\n                    <Text className=\"text-center text-white font-semibold\">\n                      Submit\n                    </Text>\n                  </TouchableOpacity>\n                  <TouchableOpacity\n                    onPress={() => setShowNewTicketForm(false)}\n                    className=\"flex-1 bg-gray-200 py-2 rounded-lg\"\n                  >\n                    <Text className=\"text-center text-gray-900 font-semibold\">\n                      Cancel\n                    </Text>\n                  </TouchableOpacity>\n                </View>\n              </View>\n            ) : null}\n\n            {tickets.length === 0 ? (\n              <View className=\"items-center py-8\">\n                <Ionicons name=\"ticket\" size={48} color=\"#D1D5DB\" />\n                <Text className=\"text-gray-600 mt-4\">No support tickets yet</Text>\n              </View>\n            ) : (\n              tickets.map((ticket) => (\n                <View\n                  key={ticket.id}\n                  className=\"bg-white rounded-lg p-4 mb-3 border border-gray-200\"\n                >\n                  <View className=\"flex-row justify-between items-start mb-2\">\n                    <Text className=\"font-semibold text-gray-900 flex-1\">\n                      {ticket.subject}\n                    </Text>\n                    <View\n                      className={`px-2 py-1 rounded ${\n                        ticket.status === 'open'\n                          ? 'bg-blue-100'\n                          : 'bg-green-100'\n                      }`}\n                    >\n                      <Text\n                        className={`text-xs font-semibold ${\n                          ticket.status === 'open'\n                            ? 'text-blue-700'\n                            : 'text-green-700'\n                        }`}\n                      >\n                        {ticket.status.toUpperCase()}\n                      </Text>\n                    </View>\n                  </View>\n                  <Text className=\"text-xs text-gray-500\">\n                    {new Date(ticket.createdAt).toLocaleDateString()}\n                  </Text>\n                </View>\n              ))\n            )}\n          </>\n        )}\n\n        {/* Contact Tab */}\n        {activeTab === 'contact' && (\n          <>\n            <View className=\"bg-white rounded-lg p-4 mb-4 border border-gray-200\">\n              <Text className=\"text-lg font-bold text-gray-900 mb-4\">\n                Contact Us\n              </Text>\n\n              <TouchableOpacity className=\"flex-row items-center mb-4 p-3 bg-blue-50 rounded-lg\">\n                <Ionicons name=\"call\" size={24} color=\"#3B82F6\" />\n                <View className=\"ml-3 flex-1\">\n                  <Text className=\"font-semibold text-gray-900\">Call Support</Text>\n                  <Text className=\"text-sm text-gray-600\">+1 (555) 123-4567</Text>\n                </View>\n              </TouchableOpacity>\n\n              <TouchableOpacity className=\"flex-row items-center mb-4 p-3 bg-green-50 rounded-lg\">\n                <Ionicons name=\"mail\" size={24} color=\"#10B981\" />\n                <View className=\"ml-3 flex-1\">\n                  <Text className=\"font-semibold text-gray-900\">Email Support</Text>\n                  <Text className=\"text-sm text-gray-600\">support@ntumai.com</Text>\n                </View>\n              </TouchableOpacity>\n\n              <TouchableOpacity className=\"flex-row items-center p-3 bg-purple-50 rounded-lg\">\n                <Ionicons name=\"chatbubble\" size={24} color=\"#A855F7\" />\n                <View className=\"ml-3 flex-1\">\n                  <Text className=\"font-semibold text-gray-900\">Live Chat</Text>\n                  <Text className=\"text-sm text-gray-600\">Available 24/7</Text>\n                </View>\n              </TouchableOpacity>\n            </View>\n          </>\n        )}\n      </ScrollView>\n\n      {/* Create Ticket Button */}\n      {activeTab === 'tickets' && !showNewTicketForm && (\n        <View className=\"px-4 py-4 border-t border-gray-200 bg-white\">\n          <TouchableOpacity\n            onPress={() => setShowNewTicketForm(true)}\n            className=\"bg-blue-500 py-3 rounded-lg flex-row items-center justify-center\"\n          >\n            <Ionicons name=\"add\" size={24} color=\"white\" />\n            <Text className=\"text-white font-bold ml-2\">New Ticket</Text>\n          </TouchableOpacity>\n        </View>\n      )}\n    </View>\n  );\n}\n
