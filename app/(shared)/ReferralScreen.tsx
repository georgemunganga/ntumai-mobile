import React, { useState, useEffect } from 'react';\nimport {\n  View,\n  Text,\n  ScrollView,\n  TouchableOpacity,\n  TextInput,\n  Alert,\n  ActivityIndicator,\n  Share,\n  Clipboard,\n} from 'react-native';\nimport { Ionicons } from '@expo/vector-icons';\nimport { referralMockService } from '../../src/api/mockServices.extended';\n\nexport default function ReferralScreen() {\n  const [referralData, setReferralData] = useState<any>(null);\n  const [loading, setLoading] = useState(true);\n  const [referralCode, setReferralCode] = useState('');\n  const [applyingCode, setApplyingCode] = useState(false);\n  const [copiedCode, setCopiedCode] = useState(false);\n\n  useEffect(() => {\n    loadReferralData();\n  }, []);\n\n  const loadReferralData = async () => {\n    try {\n      const response = await referralMockService.getReferralCode('user_1');\n      if (response.success) {\n        setReferralData(response.data);\n      }\n    } catch (error) {\n      Alert.alert('Error', 'Failed to load referral data');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleCopyCode = async () => {\n    try {\n      await Clipboard.setString(referralData.referralCode);\n      setCopiedCode(true);\n      setTimeout(() => setCopiedCode(false), 2000);\n    } catch (error) {\n      Alert.alert('Error', 'Failed to copy code');\n    }\n  };\n\n  const handleShareCode = async () => {\n    try {\n      await Share.share({\n        message: `Join Ntumai using my referral code: ${referralData.referralCode}. Get ₭5 credit when you sign up!`,\n        title: 'Ntumai Referral',\n      });\n    } catch (error) {\n      Alert.alert('Error', 'Failed to share code');\n    }\n  };\n\n  const handleApplyCode = async () => {\n    if (!referralCode.trim()) {\n      Alert.alert('Error', 'Please enter a referral code');\n      return;\n    }\n\n    setApplyingCode(true);\n    try {\n      const response = await referralMockService.applyReferralCode(\n        referralCode.trim()\n      );\n      if (response.success) {\n        Alert.alert('Success', response.data.message);\n        setReferralCode('');\n      }\n    } catch (error) {\n      Alert.alert('Error', 'Invalid referral code');\n    } finally {\n      setApplyingCode(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      <View className=\"flex-1 justify-center items-center bg-white\">\n        <ActivityIndicator size=\"large\" color=\"#FF6B35\" />\n      </View>\n    );\n  }\n\n  return (\n    <ScrollView className=\"flex-1 bg-gray-50\" showsVerticalScrollIndicator={false}>\n      {/* Header */}\n      <View className=\"bg-white border-b border-gray-200 px-4 py-4\">\n        <Text className=\"text-2xl font-bold text-gray-900\">Referrals & Rewards</Text>\n        <Text className=\"text-sm text-gray-600 mt-1\">\n          Earn credits by referring friends\n        </Text>\n      </View>\n\n      <View className=\"px-4 py-4\">\n        {/* Your Referral Code */}\n        <View className=\"bg-gradient-to-r from-purple-500 to-pink-500 rounded-lg p-6 mb-6 text-white\">\n          <Text className=\"text-white text-sm opacity-90 mb-2\">Your Referral Code</Text>\n          <Text className=\"text-white text-3xl font-bold mb-4 tracking-wider\">\n            {referralData?.referralCode}\n          </Text>\n          <View className=\"flex-row gap-2\">\n            <TouchableOpacity\n              onPress={handleCopyCode}\n              className=\"flex-1 bg-white bg-opacity-20 py-2 rounded-lg flex-row items-center justify-center\"\n            >\n              <Ionicons name=\"copy\" size={18} color=\"white\" />\n              <Text className=\"text-white font-semibold ml-2\">\n                {copiedCode ? 'Copied!' : 'Copy'}\n              </Text>\n            </TouchableOpacity>\n            <TouchableOpacity\n              onPress={handleShareCode}\n              className=\"flex-1 bg-white bg-opacity-20 py-2 rounded-lg flex-row items-center justify-center\"\n            >\n              <Ionicons name=\"share-social\" size={18} color=\"white\" />\n              <Text className=\"text-white font-semibold ml-2\">Share</Text>\n            </TouchableOpacity>\n          </View>\n        </View>\n\n        {/* Earnings Summary */}\n        <View className=\"grid grid-cols-2 gap-4 mb-6\">\n          <View className=\"bg-white rounded-lg p-4 border border-gray-200\">\n            <Text className=\"text-gray-600 text-sm mb-1\">Total Referrals</Text>\n            <Text className=\"text-3xl font-bold text-gray-900\">\n              {referralData?.totalReferrals}\n            </Text>\n          </View>\n          <View className=\"bg-white rounded-lg p-4 border border-gray-200\">\n            <Text className=\"text-gray-600 text-sm mb-1\">Total Earnings</Text>\n            <Text className=\"text-3xl font-bold text-green-600\">\n              ₭{referralData?.totalEarnings.toFixed(2)}\n            </Text>\n          </View>\n        </View>\n\n        {/* Pending Earnings */}\n        {referralData?.pendingEarnings > 0 && (\n          <View className=\"bg-yellow-50 rounded-lg p-4 mb-6 border border-yellow-200\">\n            <View className=\"flex-row items-center justify-between\">\n              <View>\n                <Text className=\"text-yellow-900 text-sm\">Pending Earnings</Text>\n                <Text className=\"text-2xl font-bold text-yellow-900 mt-1\">\n                  ₭{referralData?.pendingEarnings.toFixed(2)}\n                </Text>\n              </View>\n              <Ionicons name=\"hourglass\" size={32} color=\"#D97706\" />\n            </View>\n            <Text className=\"text-xs text-yellow-700 mt-2\">\n              These will be credited after your referrals complete their first order\n            </Text>\n          </View>\n        )}\n\n        {/* How It Works */}\n        <View className=\"bg-white rounded-lg p-4 mb-6 border border-gray-200\">\n          <Text className=\"text-lg font-bold text-gray-900 mb-4\">How It Works</Text>\n          <View className=\"space-y-3\">\n            <View className=\"flex-row items-start\">\n              <View className=\"w-6 h-6 rounded-full bg-blue-500 items-center justify-center mr-3 mt-0.5\">\n                <Text className=\"text-white text-sm font-bold\">1</Text>\n              </View>\n              <Text className=\"text-gray-700 flex-1\">Share your referral code with friends</Text>\n            </View>\n            <View className=\"flex-row items-start\">\n              <View className=\"w-6 h-6 rounded-full bg-blue-500 items-center justify-center mr-3 mt-0.5\">\n                <Text className=\"text-white text-sm font-bold\">2</Text>\n              </View>\n              <Text className=\"text-gray-700 flex-1\">\n                They sign up using your code\n              </Text>\n            </View>\n            <View className=\"flex-row items-start\">\n              <View className=\"w-6 h-6 rounded-full bg-blue-500 items-center justify-center mr-3 mt-0.5\">\n                <Text className=\"text-white text-sm font-bold\">3</Text>\n              </View>\n              <Text className=\"text-gray-700 flex-1\">\n                They complete their first order\n              </Text>\n            </View>\n            <View className=\"flex-row items-start\">\n              <View className=\"w-6 h-6 rounded-full bg-blue-500 items-center justify-center mr-3 mt-0.5\">\n                <Text className=\"text-white text-sm font-bold\">4</Text>\n              </View>\n              <Text className=\"text-gray-700 flex-1\">\n                You both get ₭5 credit!\n              </Text>\n            </View>\n          </View>\n        </View>\n\n        {/* Apply Referral Code */}\n        <View className=\"bg-white rounded-lg p-4 border border-gray-200 mb-6\">\n          <Text className=\"text-lg font-bold text-gray-900 mb-3\">Have a Referral Code?</Text>\n          <TextInput\n            value={referralCode}\n            onChangeText={setReferralCode}\n            placeholder=\"Enter referral code\"\n            className=\"bg-gray-100 rounded-lg px-4 py-3 text-gray-900 mb-3 border border-gray-200\"\n            placeholderTextColor=\"#999\"\n          />\n          <TouchableOpacity\n            onPress={handleApplyCode}\n            disabled={applyingCode}\n            className={`py-3 rounded-lg ${\n              applyingCode ? 'bg-gray-300' : 'bg-blue-500'\n            }`}\n          >\n            <Text className=\"text-center text-white font-bold\">\n              {applyingCode ? 'Applying...' : 'Apply Code'}\n            </Text>\n          </TouchableOpacity>\n        </View>\n\n        {/* Terms */}\n        <View className=\"bg-gray-100 rounded-lg p-4 mb-6\">\n          <Text className=\"text-xs text-gray-600 leading-5\">\n            <Text className=\"font-bold\">Terms: </Text>\n            Referral credits are valid for 30 days. One referral code per user. Credits cannot be transferred or refunded.\n          </Text>\n        </View>\n      </View>\n    </ScrollView>\n  );\n}\n
