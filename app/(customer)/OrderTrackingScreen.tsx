import React, { useEffect, useState } from 'react';\nimport {\n  View,\n  Text,\n  TouchableOpacity,\n  ScrollView,\n  Image,\n  ActivityIndicator,\n} from 'react-native';\nimport { useRouter, useLocalSearchParams } from 'expo-router';\nimport { useOrderStore } from '../../src/store';\nimport { Feather } from '@expo/vector-icons';\n\nconst OrderSteps = [\n  { id: 'confirmed', label: 'Order Confirmed', icon: 'check-circle' },\n  { id: 'preparing', label: 'Being Prepared', icon: 'clock' },\n  { id: 'ready', label: 'Ready for Pickup', icon: 'package' },\n  { id: 'on_way', label: 'On the Way', icon: 'truck' },\n  { id: 'delivered', label: 'Delivered', icon: 'home' },\n];\n\nexport default function OrderTrackingScreen() {\n  const router = useRouter();\n  const { orderId } = useLocalSearchParams();\n  const { getOrderDetail, selectedOrder, isLoading } = useOrderStore();\n  const [currentStep, setCurrentStep] = useState(0);\n\n  useEffect(() => {\n    if (orderId) {\n      getOrderDetail(orderId as string);\n    }\n  }, [orderId]);\n\n  useEffect(() => {\n    if (selectedOrder) {\n      const stepIndex = OrderSteps.findIndex(s => s.id === selectedOrder.status);\n      setCurrentStep(Math.max(0, stepIndex));\n    }\n  }, [selectedOrder]);\n\n  if (isLoading || !selectedOrder) {\n    return (\n      <View className=\"flex-1 bg-white items-center justify-center\">\n        <ActivityIndicator size=\"large\" color=\"#16A34A\" />\n      </View>\n    );\n  }\n\n  const estimatedDelivery = new Date(selectedOrder.estimatedDeliveryTime);\n  const isDelivered = selectedOrder.status === 'delivered';\n\n  return (\n    <View className=\"flex-1 bg-white\">\n      {/* Header */}\n      <View className=\"px-6 py-4 border-b border-gray-200 flex-row items-center\">\n        <TouchableOpacity onPress={() => router.back()} className=\"mr-4\">\n          <Feather name=\"chevron-left\" size={24} color=\"#1F2937\" />\n        </TouchableOpacity>\n        <View className=\"flex-1\">\n          <Text className=\"text-2xl font-bold text-gray-900\">Order #{selectedOrder.id.slice(-4)}</Text>\n          <Text className=\"text-gray-600 text-sm\">{new Date(selectedOrder.createdAt).toLocaleDateString()}</Text>\n        </View>\n      </View>\n\n      <ScrollView className=\"flex-1\">\n        {/* Status Card */}\n        <View className=\"px-6 py-6 bg-gradient-to-r from-green-50 to-blue-50 border-b border-gray-200\">\n          <View className=\"flex-row items-center justify-between mb-4\">\n            <View>\n              <Text className=\"text-gray-600 text-sm mb-1\">Current Status</Text>\n              <Text className=\"text-2xl font-bold text-gray-900 capitalize\">\n                {selectedOrder.status.replace('_', ' ')}\n              </Text>\n            </View>\n            <View className={`px-4 py-2 rounded-full ${\n              isDelivered ? 'bg-green-100' : 'bg-yellow-100'\n            }`}>\n              <Text className={`font-bold text-sm ${\n                isDelivered ? 'text-green-700' : 'text-yellow-700'\n              }`}>\n                {isDelivered ? '✓ Delivered' : '⏱ In Progress'}\n              </Text>\n            </View>\n          </View>\n\n          {!isDelivered && (\n            <Text className=\"text-gray-600 text-sm\">\n              Estimated delivery: {estimatedDelivery.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\n            </Text>\n          )}\n        </View>\n\n        {/* Timeline */}\n        <View className=\"px-6 py-8\">\n          <Text className=\"text-lg font-bold text-gray-900 mb-6\">Order Timeline</Text>\n\n          {OrderSteps.map((step, index) => {\n            const isCompleted = index <= currentStep;\n            const isCurrent = index === currentStep;\n\n            return (\n              <View key={step.id} className=\"mb-6 flex-row\">\n                {/* Timeline Line and Circle */}\n                <View className=\"items-center mr-4\">\n                  <View className={`w-12 h-12 rounded-full items-center justify-center ${\n                    isCompleted ? 'bg-green-600' : 'bg-gray-200'\n                  }`}>\n                    <Feather\n                      name={isCompleted ? 'check' : step.icon as any}\n                      size={24}\n                      color={isCompleted ? 'white' : '#9CA3AF'}\n                    />\n                  </View>\n                  {index < OrderSteps.length - 1 && (\n                    <View className={`w-1 h-12 ${\n                      isCompleted ? 'bg-green-600' : 'bg-gray-200'\n                    }`} />\n                  )}\n                </View>\n\n                {/* Step Info */}\n                <View className=\"flex-1 pt-2\">\n                  <Text className={`text-lg font-bold ${\n                    isCompleted ? 'text-gray-900' : 'text-gray-400'\n                  }`}>\n                    {step.label}\n                  </Text>\n                  {isCurrent && !isDelivered && (\n                    <Text className=\"text-green-600 text-sm font-semibold mt-1\">In progress...</Text>\n                  )}\n                  {isCompleted && index < currentStep && (\n                    <Text className=\"text-gray-600 text-sm mt-1\">Completed</Text>\n                  )}\n                </View>\n              </View>\n            );\n          })}\n        </View>\n\n        {/* Driver Info */}\n        {selectedOrder.driver && (\n          <View className=\"px-6 py-6 border-t border-gray-200\">\n            <Text className=\"text-lg font-bold text-gray-900 mb-4\">Your Driver</Text>\n            <View className=\"bg-gray-50 rounded-lg p-4 flex-row items-center\">\n              <Image\n                source={{ uri: selectedOrder.driver.avatar }}\n                className=\"w-16 h-16 rounded-full mr-4\"\n              />\n              <View className=\"flex-1\">\n                <Text className=\"text-lg font-bold text-gray-900\">{selectedOrder.driver.name}</Text>\n                <View className=\"flex-row items-center mt-2\">\n                  <Feather name=\"star\" size={16} color=\"#FCD34D\" fill=\"#FCD34D\" />\n                  <Text className=\"text-gray-700 font-semibold ml-1\">{selectedOrder.driver.rating}</Text>\n                </View>\n              </View>\n              <TouchableOpacity className=\"bg-green-600 rounded-full p-3\">\n                <Feather name=\"phone\" size={20} color=\"white\" />\n              </TouchableOpacity>\n            </View>\n          </View>\n        )}\n\n        {/* Order Items */}\n        <View className=\"px-6 py-6 border-t border-gray-200\">\n          <Text className=\"text-lg font-bold text-gray-900 mb-4\">Order Items</Text>\n          {selectedOrder.items.map((item, index) => (\n            <View key={index} className=\"flex-row items-center mb-4 pb-4 border-b border-gray-200\">\n              <Image\n                source={{ uri: item.product.image }}\n                className=\"w-16 h-16 rounded-lg mr-4\"\n              />\n              <View className=\"flex-1\">\n                <Text className=\"text-lg font-bold text-gray-900\">{item.product.name}</Text>\n                <Text className=\"text-gray-600 text-sm\">Qty: {item.quantity}</Text>\n              </View>\n              <Text className=\"text-lg font-bold text-green-600\">{item.product.price * item.quantity}K</Text>\n            </View>\n          ))}\n        </View>\n\n        {/* Price Summary */}\n        <View className=\"px-6 py-6 border-t border-gray-200\">\n          <View className=\"bg-gray-50 rounded-lg p-4 gap-3\">\n            <View className=\"flex-row items-center justify-between\">\n              <Text className=\"text-gray-600\">Subtotal</Text>\n              <Text className=\"text-gray-900 font-semibold\">{selectedOrder.subtotal}K</Text>\n            </View>\n            <View className=\"flex-row items-center justify-between\">\n              <Text className=\"text-gray-600\">Delivery Fee</Text>\n              <Text className=\"text-gray-900 font-semibold\">{selectedOrder.deliveryFee}K</Text>\n            </View>\n            <View className=\"border-t border-gray-200 pt-3 flex-row items-center justify-between\">\n              <Text className=\"text-lg font-bold text-gray-900\">Total</Text>\n              <Text className=\"text-2xl font-bold text-green-600\">{selectedOrder.totalAmount}K</Text>\n            </View>\n          </View>\n        </View>\n      </ScrollView>\n\n      {/* Action Buttons */}\n      {isDelivered && (\n        <View className=\"px-6 py-6 border-t border-gray-200 gap-3\">\n          <TouchableOpacity className=\"bg-green-600 rounded-lg py-4\">\n            <Text className=\"text-white text-center font-bold text-lg\">Rate Order</Text>\n          </TouchableOpacity>\n          <TouchableOpacity\n            onPress={() => router.push('/(customer)/Home')}\n            className=\"bg-gray-100 rounded-lg py-4\"\n          >\n            <Text className=\"text-gray-900 text-center font-bold text-lg\">Back to Home</Text>\n          </TouchableOpacity>\n        </View>\n      )}\n    </View>\n  );\n}\n
