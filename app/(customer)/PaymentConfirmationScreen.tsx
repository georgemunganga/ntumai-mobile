import React, { useState, useEffect } from 'react';\nimport {\n  View,\n  Text,\n  TouchableOpacity,\n  ScrollView,\n  Alert,\n  Dimensions,\n} from 'react-native';\nimport { useRouter, useRoute } from 'expo-router';\nimport { Ionicons } from '@expo/vector-icons';\nimport { paymentMockService } from '../../src/api/mockServices.extended';\n\nconst { width } = Dimensions.get('window');\n\nexport default function PaymentConfirmationScreen() {\n  const router = useRouter();\n  const route = useRoute();\n  const { orderId, amount, paymentMethod } = route.params as any;\n\n  const [processing, setProcessing] = useState(false);\n  const [paymentStatus, setPaymentStatus] = useState<'pending' | 'success' | 'failed'>('pending');\n  const [transactionId, setTransactionId] = useState<string | null>(null);\n\n  const orderData = {\n    orderId,\n    amount,\n    paymentMethod,\n    items: [\n      { name: 'Item 1', quantity: 2, price: 10.0 },\n      { name: 'Item 2', quantity: 1, price: 15.0 },\n    ],\n    subtotal: 35.0,\n    deliveryFee: 2.0,\n    tax: 3.7,\n    total: amount,\n  };\n\n  useEffect(() => {\n    // Auto-process payment after 2 seconds\n    const timer = setTimeout(() => {\n      handleProcessPayment();\n    }, 2000);\n\n    return () => clearTimeout(timer);\n  }, []);\n\n  const handleProcessPayment = async () => {\n    setProcessing(true);\n    try {\n      const response = await paymentMockService.processPayment({\n        amount,\n        method: paymentMethod,\n        orderId,\n      });\n\n      if (response.success) {\n        setTransactionId(response.data.transactionId);\n        setPaymentStatus('success');\n      } else {\n        setPaymentStatus('failed');\n      }\n    } catch (error) {\n      setPaymentStatus('failed');\n    } finally {\n      setProcessing(false);\n    }\n  };\n\n  const handleRetry = () => {\n    setPaymentStatus('pending');\n    handleProcessPayment();\n  };\n\n  const handleContinue = () => {\n    router.push({\n      pathname: '/(customer)/OrderTrackingScreen',\n      params: { orderId },\n    });\n  };\n\n  return (\n    <ScrollView className=\"flex-1 bg-white\" showsVerticalScrollIndicator={false}>\n      {/* Status Section */}\n      <View className=\"items-center justify-center py-8\">\n        {paymentStatus === 'pending' && (\n          <>\n            <View className=\"w-16 h-16 rounded-full bg-blue-100 items-center justify-center mb-4\">\n              <Text className=\"text-3xl\">ðŸ’³</Text>\n            </View>\n            <Text className=\"text-2xl font-bold text-gray-900 mb-2\">Processing Payment</Text>\n            <Text className=\"text-gray-600 text-center\">Please wait while we process your payment...</Text>\n          </>\n        )}\n\n        {paymentStatus === 'success' && (\n          <>\n            <View className=\"w-16 h-16 rounded-full bg-green-100 items-center justify-center mb-4\">\n              <Ionicons name=\"checkmark-circle\" size={64} color=\"#10B981\" />\n            </View>\n            <Text className=\"text-2xl font-bold text-green-600 mb-2\">Payment Successful</Text>\n            <Text className=\"text-gray-600 text-center\">Your payment has been processed</Text>\n          </>\n        )}\n\n        {paymentStatus === 'failed' && (\n          <>\n            <View className=\"w-16 h-16 rounded-full bg-red-100 items-center justify-center mb-4\">\n              <Ionicons name=\"close-circle\" size={64} color=\"#EF4444\" />\n            </View>\n            <Text className=\"text-2xl font-bold text-red-600 mb-2\">Payment Failed</Text>\n            <Text className=\"text-gray-600 text-center\">Unable to process your payment. Please try again.</Text>\n          </>\n        )}\n      </View>\n\n      {/* Transaction Details */}\n      <View className=\"px-4 py-6\">\n        {/* Order Summary */}\n        <View className=\"bg-gray-50 rounded-lg p-4 mb-6 border border-gray-200\">\n          <Text className=\"text-lg font-bold text-gray-900 mb-4\">Order Summary</Text>\n\n          {orderData.items.map((item, index) => (\n            <View key={index} className=\"flex-row justify-between mb-2\">\n              <Text className=\"text-gray-600\">\n                {item.name} x {item.quantity}\n              </Text>\n              <Text className=\"text-gray-900 font-semibold\">â‚­{item.price.toFixed(2)}</Text>\n            </View>\n          ))}\n\n          <View className=\"border-t border-gray-300 my-3\" />\n\n          <View className=\"flex-row justify-between mb-2\">\n            <Text className=\"text-gray-600\">Subtotal</Text>\n            <Text className=\"text-gray-900\">â‚­{orderData.subtotal.toFixed(2)}</Text>\n          </View>\n          <View className=\"flex-row justify-between mb-2\">\n            <Text className=\"text-gray-600\">Delivery Fee</Text>\n            <Text className=\"text-gray-900\">â‚­{orderData.deliveryFee.toFixed(2)}</Text>\n          </View>\n          <View className=\"flex-row justify-between mb-3\">\n            <Text className=\"text-gray-600\">Tax</Text>\n            <Text className=\"text-gray-900\">â‚­{orderData.tax.toFixed(2)}</Text>\n          </View>\n\n          <View className=\"bg-white p-3 rounded-lg\">\n            <View className=\"flex-row justify-between\">\n              <Text className=\"text-lg font-bold text-gray-900\">Total</Text>\n              <Text className=\"text-2xl font-bold text-blue-600\">\n                â‚­{orderData.total.toFixed(2)}\n              </Text>\n            </View>\n          </View>\n        </View>\n\n        {/* Payment Details */}\n        <View className=\"bg-gray-50 rounded-lg p-4 mb-6 border border-gray-200\">\n          <Text className=\"text-lg font-bold text-gray-900 mb-3\">Payment Details</Text>\n          <View className=\"flex-row justify-between mb-2\">\n            <Text className=\"text-gray-600\">Order ID</Text>\n            <Text className=\"text-gray-900 font-mono text-sm\">{orderId}</Text>\n          </View>\n          <View className=\"flex-row justify-between mb-2\">\n            <Text className=\"text-gray-600\">Payment Method</Text>\n            <Text className=\"text-gray-900 font-semibold\">\n              {paymentMethod === 'card'\n                ? 'Credit/Debit Card'\n                : paymentMethod === 'wallet'\n                ? 'Wallet'\n                : 'Cash on Delivery'}\n            </Text>\n          </View>\n          {transactionId && (\n            <View className=\"flex-row justify-between\">\n              <Text className=\"text-gray-600\">Transaction ID</Text>\n              <Text className=\"text-gray-900 font-mono text-sm\">{transactionId}</Text>\n            </View>\n          )}\n        </View>\n\n        {/* Status Message */}\n        {paymentStatus === 'success' && (\n          <View className=\"bg-green-50 rounded-lg p-4 mb-6 border border-green-200\">\n            <Text className=\"text-green-900 text-center\">\n              Your order has been confirmed. You'll receive a confirmation email shortly.\n            </Text>\n          </View>\n        )}\n\n        {paymentStatus === 'failed' && (\n          <View className=\"bg-red-50 rounded-lg p-4 mb-6 border border-red-200\">\n            <Text className=\"text-red-900 text-center mb-3\">\n              We couldn't process your payment. Please check your payment details and try again.\n            </Text>\n            <TouchableOpacity\n              onPress={handleRetry}\n              className=\"bg-red-500 py-2 rounded-lg\"\n            >\n              <Text className=\"text-center text-white font-semibold\">Retry Payment</Text>\n            </TouchableOpacity>\n          </View>\n        )}\n      </View>\n\n      {/* Action Button */}\n      {paymentStatus === 'success' && (\n        <View className=\"px-4 pb-6\">\n          <TouchableOpacity\n            onPress={handleContinue}\n            className=\"bg-blue-500 py-4 rounded-lg\"\n          >\n            <Text className=\"text-center text-white font-bold text-lg\">\n              Continue to Order Tracking\n            </Text>\n          </TouchableOpacity>\n        </View>\n      )}\n\n      {paymentStatus === 'failed' && (\n        <View className=\"px-4 pb-6 flex-row gap-2\">\n          <TouchableOpacity\n            onPress={() => router.back()}\n            className=\"flex-1 bg-gray-200 py-3 rounded-lg\"\n          >\n            <Text className=\"text-center text-gray-900 font-semibold\">Go Back</Text>\n          </TouchableOpacity>\n          <TouchableOpacity\n            onPress={handleRetry}\n            className=\"flex-1 bg-blue-500 py-3 rounded-lg\"\n          >\n            <Text className=\"text-center text-white font-semibold\">Retry</Text>\n          </TouchableOpacity>\n        </View>\n      )}\n    </ScrollView>\n  );\n}\n
