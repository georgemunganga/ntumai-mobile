# API Integration Guide\n\n## Overview\n\nThis guide explains how to integrate the real backend APIs with the Ntumai mobile app. Currently, the app uses mock API services that can be easily replaced with real endpoints.\n\n## Current Architecture\n\n### Mock API Services Location\n- **File**: `/src/api/mockServices.ts`\n- **Mock Data**: `/src/api/mockData.ts`\n- **API Client**: `/src/api/client.ts`\n\n### Service Structure\n\nEach service follows this pattern:\n\n```typescript\nexport const authService = {\n  login: async (phone: string) => Promise<LoginResponse>,\n  verifyOtp: async (phone: string, otp: string) => Promise<AuthResponse>,\n  // ... other methods\n};\n```\n\n## Integration Steps\n\n### Step 1: Update API Client\n\nModify `/src/api/client.ts` to point to your backend:\n\n```typescript\nconst API_BASE_URL = 'https://your-api.com/api/v1';\n\nconst apiClient = axios.create({\n  baseURL: API_BASE_URL,\n  timeout: 10000,\n  headers: {\n    'Content-Type': 'application/json',\n  },\n});\n```\n\n### Step 2: Replace Mock Services\n\nUpdate each service in `/src/api/mockServices.ts`:\n\n#### Authentication Service\n\n```typescript\nexport const authService = {\n  login: async (phone: string) => {\n    const response = await apiClient.post('/auth/login', { phone });\n    return response.data;\n  },\n  \n  verifyOtp: async (phone: string, otp: string) => {\n    const response = await apiClient.post('/auth/verify-otp', { phone, otp });\n    // Store token\n    await AsyncStorage.setItem('authToken', response.data.token);\n    return response.data;\n  },\n  \n  logout: async () => {\n    await apiClient.post('/auth/logout');\n    await AsyncStorage.removeItem('authToken');\n  },\n};\n```\n\n#### Marketplace Service\n\n```typescript\nexport const marketplaceService = {\n  getVendors: async (page: number = 1, limit: number = 20) => {\n    const response = await apiClient.get('/vendors', {\n      params: { page, limit },\n    });\n    return response.data;\n  },\n  \n  searchVendors: async (query: string) => {\n    const response = await apiClient.get('/vendors/search', {\n      params: { q: query },\n    });\n    return response.data;\n  },\n  \n  getVendorDetail: async (vendorId: string) => {\n    const response = await apiClient.get(`/vendors/${vendorId}`);\n    return response.data;\n  },\n};\n```\n\n### Step 3: Update Request/Response Types\n\nEnsure your API responses match the expected types in `/src/api/types.ts`:\n\n```typescript\ninterface Vendor {\n  id: string;\n  name: string;\n  logo: string;\n  rating: number;\n  deliveryTime: string;\n  deliveryFee: number;\n  minOrder: number;\n  categories: Category[];\n  products: Product[];\n}\n\ninterface Product {\n  id: string;\n  vendorId: string;\n  name: string;\n  description: string;\n  price: number;\n  image: string;\n  category: string;\n  inStock: boolean;\n  rating: number;\n}\n```\n\n### Step 4: Implement Authentication\n\n#### Token Management\n\n```typescript\n// Add token to requests\napiClient.interceptors.request.use(\n  async (config) => {\n    const token = await AsyncStorage.getItem('authToken');\n    if (token) {\n      config.headers.Authorization = `Bearer ${token}`;\n    }\n    return config;\n  },\n  (error) => Promise.reject(error)\n);\n\n// Handle token refresh\napiClient.interceptors.response.use(\n  (response) => response,\n  async (error) => {\n    const originalRequest = error.config;\n    \n    if (error.response?.status === 401 && !originalRequest._retry) {\n      originalRequest._retry = true;\n      \n      try {\n        const refreshToken = await AsyncStorage.getItem('refreshToken');\n        const response = await apiClient.post('/auth/refresh', { refreshToken });\n        \n        await AsyncStorage.setItem('authToken', response.data.token);\n        originalRequest.headers.Authorization = `Bearer ${response.data.token}`;\n        \n        return apiClient(originalRequest);\n      } catch (refreshError) {\n        // Redirect to login\n        return Promise.reject(refreshError);\n      }\n    }\n    \n    return Promise.reject(error);\n  }\n);\n```\n\n### Step 5: Implement Real-time Features\n\n#### WebSocket for Order Tracking\n\n```typescript\nimport io from 'socket.io-client';\n\nconst socket = io('https://your-api.com', {\n  auth: {\n    token: authToken,\n  },\n});\n\n// Listen for order updates\nsocket.on('order:updated', (order) => {\n  useOrderStore.setState({ selectedOrder: order });\n});\n\n// Listen for delivery updates\nsocket.on('delivery:updated', (delivery) => {\n  useDeliveryStore.setState({ selectedDelivery: delivery });\n});\n```\n\n#### Push Notifications\n\n```typescript\nimport * as Notifications from 'expo-notifications';\n\n// Register for push notifications\nconst registerForPushNotifications = async () => {\n  const { status } = await Notifications.requestPermissionsAsync();\n  \n  if (status === 'granted') {\n    const token = (await Notifications.getExpoPushTokenAsync()).data;\n    \n    // Send token to backend\n    await apiClient.post('/notifications/register', { token });\n  }\n};\n```\n\n### Step 6: Error Handling\n\nImplement consistent error handling:\n\n```typescript\ninterface ApiError {\n  code: string;\n  message: string;\n  details?: Record<string, any>;\n}\n\nconst handleApiError = (error: any): ApiError => {\n  if (error.response?.data) {\n    return error.response.data;\n  }\n  \n  return {\n    code: 'UNKNOWN_ERROR',\n    message: 'An unexpected error occurred',\n  };\n};\n\n// Use in services\ntry {\n  const response = await apiClient.post('/orders', orderData);\n  return response.data;\n} catch (error) {\n  const apiError = handleApiError(error);\n  throw new Error(apiError.message);\n}\n```\n\n## API Endpoints Reference\n\n### Authentication\n- `POST /auth/login` - Login with phone\n- `POST /auth/verify-otp` - Verify OTP\n- `POST /auth/refresh` - Refresh token\n- `POST /auth/logout` - Logout\n\n### Marketplace\n- `GET /vendors` - Get vendors list\n- `GET /vendors/:id` - Get vendor detail\n- `GET /vendors/search` - Search vendors\n- `GET /vendors/:id/products` - Get vendor products\n- `GET /products/:id` - Get product detail\n\n### Orders\n- `POST /orders` - Create order\n- `GET /orders` - Get user orders\n- `GET /orders/:id` - Get order detail\n- `PUT /orders/:id/status` - Update order status\n- `POST /orders/:id/cancel` - Cancel order\n- `POST /orders/:id/rate` - Rate order\n\n### Deliveries (P2P)\n- `POST /deliveries` - Create delivery\n- `GET /deliveries` - Get user deliveries\n- `GET /deliveries/:id` - Get delivery detail\n- `PUT /deliveries/:id/status` - Update delivery status\n- `POST /deliveries/:id/rate` - Rate delivery\n\n### Tasks\n- `POST /tasks` - Create task\n- `GET /tasks` - Get user tasks\n- `GET /tasks/:id` - Get task detail\n- `PUT /tasks/:id/status` - Update task status\n- `POST /tasks/:id/rate` - Rate task\n\n### Driver/Tasker\n- `GET /driver/jobs` - Get available jobs\n- `POST /driver/jobs/:id/accept` - Accept job\n- `PUT /driver/jobs/:id/status` - Update job status\n- `GET /driver/earnings` - Get earnings\n- `GET /driver/stats` - Get driver stats\n- `PUT /driver/status` - Update online status\n\n### Vendor\n- `GET /vendor/products` - Get vendor products\n- `POST /vendor/products` - Create product\n- `PUT /vendor/products/:id` - Update product\n- `DELETE /vendor/products/:id` - Delete product\n- `GET /vendor/orders` - Get vendor orders\n- `GET /vendor/analytics` - Get analytics\n\n### User\n- `GET /user/profile` - Get user profile\n- `PUT /user/profile` - Update profile\n- `GET /user/addresses` - Get addresses\n- `POST /user/addresses` - Add address\n- `PUT /user/addresses/:id` - Update address\n- `DELETE /user/addresses/:id` - Delete address\n- `GET /user/payment-methods` - Get payment methods\n- `POST /user/payment-methods` - Add payment method\n\n### Wallet\n- `GET /wallet/balance` - Get wallet balance\n- `GET /wallet/transactions` - Get transactions\n- `POST /wallet/withdraw` - Withdraw money\n- `POST /wallet/add-money` - Add money\n\n## Testing the Integration\n\n### Using Postman\n\n1. Create a new Postman collection\n2. Add environment variables for base URL and token\n3. Test each endpoint\n4. Export and share with team\n\n### Using the App\n\n1. Update mock services\n2. Test each user flow\n3. Verify data persistence\n4. Test error scenarios\n5. Check performance\n\n## Deployment Checklist\n\n- [ ] All endpoints implemented\n- [ ] Authentication working\n- [ ] Token refresh working\n- [ ] Error handling complete\n- [ ] Real-time features working\n- [ ] Push notifications working\n- [ ] Data validation working\n- [ ] Rate limiting implemented\n- [ ] Logging implemented\n- [ ] Monitoring setup\n\n## Support\n\nFor questions or issues during integration, refer to:\n- API documentation\n- Mock service examples\n- Type definitions\n- Error handling patterns\n
